<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="RAG åº”ç”¨æ€§èƒ½ï¼Œå‡†ç¡®ç‡é‡åŒ–è¯„ä¼°"><title>RAGåº”ç”¨å¼€å‘æŒ‡å—ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•è¯„ä¼°ä¸ä¼˜åŒ–RAGåº”ç”¨æ€§èƒ½</title>
<link rel=canonical href=https://blackdzs.github.io/p/rag%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%E4%BA%8C%E5%A6%82%E4%BD%95%E8%AF%84%E4%BC%B0%E4%B8%8E%E4%BC%98%E5%8C%96rag%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="RAGåº”ç”¨å¼€å‘æŒ‡å—ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•è¯„ä¼°ä¸ä¼˜åŒ–RAGåº”ç”¨æ€§èƒ½"><meta property='og:description' content="RAG åº”ç”¨æ€§èƒ½ï¼Œå‡†ç¡®ç‡é‡åŒ–è¯„ä¼°"><meta property='og:url' content='https://blackdzs.github.io/p/rag%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%E4%BA%8C%E5%A6%82%E4%BD%95%E8%AF%84%E4%BC%B0%E4%B8%8E%E4%BC%98%E5%8C%96rag%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD/'><meta property='og:site_name' content="DIZS' Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='langchain'><meta property='article:tag' content='RAGåº”ç”¨å¼€å‘'><meta property='article:published_time' content='2024-09-29T17:17:35+08:00'><meta property='article:modified_time' content='2024-09-29T17:17:35+08:00'><meta name=twitter:title content="RAGåº”ç”¨å¼€å‘æŒ‡å—ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•è¯„ä¼°ä¸ä¼˜åŒ–RAGåº”ç”¨æ€§èƒ½"><meta name=twitter:description content="RAG åº”ç”¨æ€§èƒ½ï¼Œå‡†ç¡®ç‡é‡åŒ–è¯„ä¼°"><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-26P4NX9J8P"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-26P4NX9J8P")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu7163769224600438988.png width=300 height=299 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>DIZS' Blog</a></h1><h2 class=site-description>ä½ å¥½ ğŸ‘‹! æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢
åœ¨è¿™é‡Œæˆ‘ä¼šåˆ†äº«AIå‰æ²¿æŠ€æœ¯å’Œè¡Œä¸šåº”ç”¨ã€‚</h2></div></header><ol class=menu-social><li><a href=mailto:1980694906@qq.com target=_blank title=Email rel=me><svg viewBox="0 0 24 21" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href=https://github.com/blackDZS target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.zhihu.com/people/di-zhen-sheng target=_blank title=Zhihu rel=me><svg viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m13.3334 3.60098v17.1471h1.79582l.75424 2.13703 3.18459-2.13703h3.93584V3.60098h-9.6705zm7.41375 14.87538h-1.79283l-2.24777 1.50849-.53276-1.50849h-.53875V5.94153h5.10911v12.53483h.00299zm-8.56906-7.18927H8.20334c.06285-1.34387.1287-3.12174.19754-5.17496h3.91788l-.00299-.24244c0-.01796-.00599-.43998-.06884-.87097-.06285-.44896-.19754-1.04457-.62854-1.04457h-6.5727c.13169-.61657.46991-2.08615.87995-2.80747l.19155-.33522-.3861-.02095c-.02394.0-.58663-.02694-1.23912.31726-1.06851.56868-1.5474 1.68807-1.75691 2.52612-.55072 2.18791-1.33489 3.70837-1.66712 4.35786-.09877.19155-.15863.30529-.18557.38311-.05387.14666-.02394.29332.0838.38909.31427.28434 1.14334-.0868 1.15232-.08979.01796-.00898.03891-.01796.06585-.02993.41603-.18856 1.64916-.74826 2.08914-2.52911h1.69705c.02095.96376.09278 4.14236.0868 5.17496H1.83715l-.06285.0449c-.69139.50582-.91288 1.8916-.92185 1.95146l-.0419.27536h4.99837c-.36814 2.34355-.79315 3.3941-1.01763 3.81313-.11074.20951-.21849.41902-.32025.62255-.63752 1.26306-1.29898 2.56802-3.7802 4.5973-.10775.0838-.20951.23944-.14367.41005.07183.18856.27835.27237.73629.27237.16162.0.35318-.00898.58065-.02993 1.49352-.13169 3.01698-.53875 4.04359-2.6219.50882-1.05056.94879-2.14601 1.31394-3.25941l4.08549 4.78886.14965-.35916c.02394-.05687.56868-1.38578.15264-2.87032l-.01497-.05387-3.23547-3.68143-.65847.49684c.19155-.78118.31726-1.49352.37413-2.12805h4.74995v-.23944c0-1.20021-.55371-1.91255-.57466-1.94248l-.07183-.08979z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>ä¸»é¡µ</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#ä»‹ç»>ä»‹ç»</a></li><li><a href=#ragè¯„ä¼°>RAGè¯„ä¼°</a><ol><li><a href=#è¯„ä¼°æŒ‡æ ‡>è¯„ä¼°æŒ‡æ ‡</a></li><li><a href=#è®¡ç®—æ–¹æ³•>è®¡ç®—æ–¹æ³•</a><ol><li><a href=#context-precison>Context Precison</a></li><li><a href=#context-recall>Context Recall</a></li><li><a href=#context-entities-recall>Context Entities Recall</a></li><li><a href=#answer-correctness>Answer Correctness</a></li><li><a href=#answer-semantic-similarity>Answer Semantic Similarity</a></li><li><a href=#answer-fathfulness>Answer Fathfulness</a></li></ol></li></ol></li><li><a href=#è®¨è®º>è®¨è®º</a></li><li><a href=#å¼•ç”¨>å¼•ç”¨</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/rag%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/>RAGåº”ç”¨å¼€å‘</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/rag%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%E4%BA%8C%E5%A6%82%E4%BD%95%E8%AF%84%E4%BC%B0%E4%B8%8E%E4%BC%98%E5%8C%96rag%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD/>RAGåº”ç”¨å¼€å‘æŒ‡å—ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•è¯„ä¼°ä¸ä¼˜åŒ–RAGåº”ç”¨æ€§èƒ½</a></h2><h3 class=article-subtitle>RAG åº”ç”¨æ€§èƒ½ï¼Œå‡†ç¡®ç‡é‡åŒ–è¯„ä¼°</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 29, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 27 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h2 id=ä»‹ç»>ä»‹ç»</h2><p>åœ¨<a class=link href=/p/rag%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%e6%8c%87%e5%8d%97%e4%b8%80%e6%b7%b1%e5%85%a5%e8%a7%a3%e6%9e%90rag%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e7%8e%b0/ title=æ·±å…¥è§£æRAGåŸç†ä¸å®ç°>æ·±å…¥è§£æRAGåŸç†ä¸å®ç°</a>ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†å¦‚ä½•æ„å»ºRAGåº”ç”¨ã€‚ç„¶è€Œï¼Œåœ¨æˆåŠŸæ„å»ºRAGåº”ç”¨åï¼Œæ–°çš„æŒ‘æˆ˜éšä¹‹è€Œæ¥ï¼šå¦‚ä½•è¯„ä¼°å…¶æ€§èƒ½ï¼Ÿæˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ ·çš„é‡åŒ–æŒ‡æ ‡æ¥è¿›è¡Œæœ‰æ•ˆçš„è¯„ä¼°ï¼Ÿ</p><h2 id=ragè¯„ä¼°>RAGè¯„ä¼°</h2><h3 id=è¯„ä¼°æŒ‡æ ‡>è¯„ä¼°æŒ‡æ ‡</h3><p>åœ¨RAGæµç¨‹ä¸­ï¼Œä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼šé—®é¢˜ï¼ˆQueryï¼‰ã€æ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼ˆContextï¼‰ä»¥åŠæ¨¡å‹ç”Ÿæˆçš„ç­”æ¡ˆï¼ˆAnswerï¼‰ã€‚åœ¨è¯„ä¼°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çœŸå®ç­”æ¡ˆï¼ˆGround Truthï¼‰ä½œä¸ºåŸºå‡†ã€‚åœ¨RAGåº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å…³æ³¨ä¸¤ä¸ªå…³é”®ç‚¹ï¼šå…¶ä¸€æ˜¯æ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼ˆContextï¼‰ï¼Œå…¶äºŒæ˜¯åŸºäºæ£€ç´¢åˆ°çš„æ–‡æ¡£æ‰€ç”Ÿæˆçš„ç­”æ¡ˆï¼ˆAnswerï¼‰ã€‚ä¸‹å›¾1å±•ç¤ºäº†è¿™ä¸¤ä¸ªéƒ¨åˆ†è®¾ç½®çš„è¯„ä¼°æŒ‡æ ‡ï¼Œå…¶ä¸­å·¦ä¾§åˆ—å‡ºäº†ä¸<code>Answer</code>ç›¸å…³çš„æŒ‡æ ‡ï¼Œå³ä¾§åˆ™å‘ˆç°äº†ä¸<code>Context</code>ç›¸å…³çš„æŒ‡æ ‡ã€‚æŒ‡æ ‡è®¡ç®—æ–¹æ³•å¯ä»¥å‚è€ƒ<a class=link href=https://docs.ragas.io/en/stable/concepts/metrics/index.html target=_blank rel=noopener>RAGAS Metrics</a></p><ul><li><p><strong>Context</strong></p><ul><li>Context Precision: æ ¹æ®Contextå’ŒGround Truthè®¡ç®—æ£€ç´¢åˆ°çš„Contextå‡†ç¡®ç‡</li><li>Context Recall: æ ¹æ®Contextå’ŒGround Truthè®¡ç®—æ£€ç´¢åˆ°çš„Contextå¬å›ç‡</li><li>Context Entities Recall: æ ¹æ®Contextå’ŒGround Truthè®¡ç®—æ£€ç´¢åˆ°çš„Context ä¸­Entitiesçš„å¬å›ç‡</li></ul></li><li><p><strong>Answer</strong></p><ul><li>Answer Faithfulness: æ ¹æ®Contextå’ŒAnswerè®¡ç®—Answeræ˜¯å¦æ¥æºäºContext</li><li>Answer Semantic Similarity: æ ¹æ®Ground Truthå’ŒAnswerè®¡ç®—Answerä¸Ground Truthçš„è¯­ä¹‰ç›¸ä¼¼æ€§(ä½¿ç”¨Embeddingå‘é‡è®¡ç®—)</li><li>Answer Correctness: æ ¹æ®Ground Truthå’ŒAnswerè®¡ç®—Answerå‡†ç¡®ç‡(ä½¿ç”¨LLMåˆ¤æ–­)</li></ul></li></ul><p>é€šè¿‡ä»¥ä¸Šè¯„ä¼°æŒ‡æ ‡ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´å…¨é¢åœ°è¯„ä»·RAGç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><figure><img src=/images/RAG%20Metrics.png width=90%><figcaption><h4>å›¾ 1. RAG è¯„ä¼°æŒ‡æ ‡</h4></figcaption></figure><h3 id=è®¡ç®—æ–¹æ³•>è®¡ç®—æ–¹æ³•</h3><p>å°½ç®¡å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„ä¸Šä¸‹æ–‡é•¿åº¦å·²æ˜¾è‘—å¢åŠ ï¼Œèƒ½å¤Ÿå°†æ•´ä¸ªæ–‡æ¡£ç”šè‡³æ–‡æœ¬è¯­æ–™åº“çº³å…¥ä¸Šä¸‹æ–‡çª—å£ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ç§åšæ³•å¾€å¾€æ•ˆç‡ä½ä¸‹ï¼Œå®¹æ˜“åˆ†æ•£æ¨¡å‹çš„æ³¨æ„åŠ›ï¼ŒåŒæ—¶ä¹Ÿä¼šå¢åŠ æ¨ç†å»¶è¿Ÿå’Œæˆæœ¬ã€‚å¯¹äºä»»ä½•ç‰¹å®šæŸ¥è¯¢ï¼Œä»…æœ‰å°‘é‡çš„æ–‡æœ¬å¯èƒ½å…·æœ‰ç›¸å…³æ€§ï¼Œä½†åœ¨æ¯æ¬¡æ¨ç†æ—¶ï¼Œä¸Šä¸‹æ–‡çª—å£ä¸­çš„æ‰€æœ‰tokenéƒ½éœ€è¢«å¤„ç†ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼ŒLLM åº”è¯¥åªå¤„ç†ä¸æŸ¥è¯¢ç›¸å…³çš„tokenã€‚å› æ­¤ï¼Œåœ¨æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰åº”ç”¨ä¸­ï¼Œæ£€ç´¢è¿‡ç¨‹çš„ä¸»è¦ç›®æ ‡ä¾¿æ˜¯ç²¾å‡†è¯†åˆ«å¹¶æå–ä¸ç»™å®šæŸ¥è¯¢ç›¸å…³çš„tokenã€‚</p><h4 id=context-precison>Context Precison</h4><p>Context Precisionï¼ˆä¸Šä¸‹æ–‡ç²¾åº¦ï¼‰æ˜¯ä¿¡æ¯æ£€ç´¢å’Œé—®ç­”ç³»ç»Ÿä¸­ç”¨æ¥è¯„ä¼°æ£€ç´¢ç»“æœè´¨é‡çš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€ã€‚åœ¨æ£€ç´¢è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå¯èƒ½ä¼šè¿”å›å¤šä¸ªä¸ç”¨æˆ·æŸ¥è¯¢ç›¸å…³çš„æ–‡æ¡£ï¼Œè¿™äº›æ–‡æ¡£çš„å†…å®¹å¯èƒ½ä¼šå¯¹ç”Ÿæˆç­”æ¡ˆäº§ç”Ÿä¸åŒç¨‹åº¦çš„å½±å“ã€‚Context Precisionçš„æ ¸å¿ƒåœ¨äºè¡¡é‡åœ¨æ£€ç´¢åˆ°çš„æ‰€æœ‰ç›¸å…³æ–‡æ¡£ä¸­ï¼Œæœ‰å¤šå°‘æ–‡æ¡£å®é™…ä¸Šå¯¹ç”Ÿæˆç”¨æˆ·éœ€è¦çš„ç­”æ¡ˆæ˜¯æœ‰å¸®åŠ©çš„ã€‚</p>\[
Context\:Precision = \frac{æœ‰ç”¨çš„æ–‡æ¡£æ•°é‡}{ç›¸å…³æ–‡æ¡£æ•°é‡}
\]<ul><li>ç›¸å…³æ–‡æ¡£æ•°é‡ ï¼šæŒ‡æ£€ç´¢ç³»ç»Ÿè¿”å›çš„æ‰€æœ‰ç›¸å…³æ–‡æ¡£çš„æ€»æ•°ã€‚</li><li>æœ‰ç”¨æ–‡æ¡£æ•°é‡ ï¼šæŒ‡åœ¨è¿™äº›ç›¸å…³æ–‡æ¡£ä¸­ï¼Œèƒ½å¤Ÿä¸ºç”Ÿæˆæ­£ç¡®ç­”æ¡ˆæä¾›æœ‰æ•ˆä¿¡æ¯çš„æ–‡æ¡£æ•°é‡ã€‚</li></ul><p>é‚£ä¹ˆå¦‚ä½•è¡¡é‡æ–‡æ¡£å¯¹äºç­”æ¡ˆç”Ÿæˆæ˜¯å¦æœ‰ç”¨å‘¢ï¼Ÿä¼ ç»Ÿçš„NLPæ–¹æ³•ä¸­å¯ä»¥ä½¿ç”¨EMç®—æ³•ï¼Œæˆ–è€…è®¡ç®—æ–‡æ¡£å’Œç­”æ¡ˆä¹‹é—´è¯çº§åŒ¹é…ï¼Œè¿™äº›æ–¹æ³•ä»…è®¡ç®—è¯çº§åˆ«çš„é‡å ï¼Œå¿½ç•¥äº†è¯­ä¹‰ä¸Šçš„è¿‘ä¼¼è¡¨è¾¾ã€‚ä¾‹å¦‚ï¼Œâ€œæœºå™¨å­¦ä¹ ç”¨äºé¢„æµ‹â€ä¸â€œæ¨¡å‹è¢«è®­ç»ƒæ¥é¢„æµ‹â€è¯­ä¹‰ç›¸è¿‘ï¼Œä½†è¯æ±‡ä¸å®Œå…¨åŒ¹é…ï¼Œå¯¼è‡´å¾—åˆ†åä½ã€‚å¯¹äºå¼€æ”¾æ€§é—®ç­”ä»»åŠ¡ï¼Œä¸Šä¸‹æ–‡å’Œç­”æ¡ˆå¯èƒ½æœ‰å¤šç§åˆç†è¡¨è¿°ï¼Œä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ æ–¹æ³•æ— æ³•å¤„ç†è¿™ç§é—®é¢˜ã€‚åŒæ—¶å¦‚æœæ–‡æ¡£åŒ…å«å¤§é‡ä¸é—®é¢˜æ— å…³çš„å†…å®¹ï¼Œåªæ˜¯å¶å°”æåˆ°äº†ä¸€äº›ç›¸å…³è¯æ±‡ï¼Œä¼šå¯¼è‡´è¯¯åˆ¤ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨åŸºäºå¤§æ¨¡å‹çš„è®¡ç®—æ–¹æ³•ï¼Œä¾èµ–äºå¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡å­¦ä¹ ä»¥åŠæ¨ç†èƒ½åŠ›è¿›è¡Œåˆ¤æ–­æ–‡æ¡£å¯¹äºç­”æ¡ˆç”Ÿæˆæ˜¯å¦æœ‰ç”¨ï¼Œå¦‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>é—®é¢˜ï¼šä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ 
</span></span><span class=line><span class=cl>æ–‡æ¡£ï¼šæœºå™¨å­¦ä¹ æ˜¯ä¸€ç§é€šè¿‡æ•°æ®è®­ç»ƒæ¨¡å‹çš„æŠ€æœ¯ï¼Œç”¨äºæ¨¡å¼è¯†åˆ«å’Œé¢„æµ‹ã€‚
</span></span><span class=line><span class=cl>æç¤ºï¼šè¿™ä¸ªæ–‡æ¡£æ˜¯å¦è¶³ä»¥å›ç­”é—®é¢˜ï¼Ÿè¯·åœ¨1-5ä¹‹é—´æ‰“åˆ†ï¼Œå¹¶è§£é‡ŠåŸå› ã€‚
</span></span></code></pre></td></tr></table></div></div><p>ä¸‹é¢æ˜¯å¯¹äºè¡¡é‡æ–‡æ¡£å¯¹äºç­”æ¡ˆç”Ÿæˆæ˜¯å¦æœ‰ç”¨çš„Promptç¤ºä¾‹ï¼Œå…¶ä¸­åŒ…å«æŒ‡ä»¤ï¼Œæ ¼å¼åŒ–è¾“å‡ºï¼Œç¤ºä¾‹å’Œè¾“å…¥ï¼Œé€šè¿‡è¿™ç§è®¾è®¡æ–¹å¼å¯ä»¥è®©å¤§æ¨¡å‹ç”Ÿæˆæ ¼å¼åŒ–çš„è¯„ä¼°ç»“æœã€‚</p><figure><img src=/images/Context%20Precision.png width=90%><figcaption><h4>å›¾ 2. Context Precision Prompt</h4></figcaption></figure><p>å› æ­¤Context Precisionçš„è®¡ç®—è¿‡ç¨‹å¦‚å›¾3æ‰€ç¤ºï¼Œé¦–å…ˆæ˜¯æ ¹æ®ç”¨æˆ·é—®é¢˜æ£€ç´¢ç›¸å…³æ–‡æ¡£ï¼Œå¯¹äºæ¯ä¸ªæ–‡æ¡£ä½¿ç”¨å›¾2ä¸­çš„Promptè¾“å…¥åˆ°å¤§æ¨¡å‹ä¸­ï¼Œè·å–å¤§æ¨¡å‹å¯¹äºæ–‡æ¡£æ˜¯å¦æœ‰ç”¨çš„åˆ¤æ–­ï¼Œæœ€ç»ˆæ ¹æ®æœ‰ç”¨çš„æ–‡æ¡£æ•°é‡è®¡ç®—<code>Context Precision</code></p><figure><img src=/images/Context%20Precision%20Caculate.png width=90%><figcaption><h4>å›¾ 3. Context Precision è®¡ç®—è¿‡ç¨‹</h4></figcaption></figure><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=n>ChatPromptTemplate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>llm</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>api_key</span><span class=o>=</span><span class=s2>&#34;your_api_key&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-4o-mini&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PROMPT</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;system&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Given question, answer and context verify if the context was useful in arriving at the given answer. Give verdict as &#34;1&#34; if useful and &#34;0&#34; if not with json output.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            The output should be a well-formatted JSON instance that conforms to the JSON schema below.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            As an example, for the schema {{&#34;properties&#34;: {{&#34;foo&#34;: {{&#34;title&#34;: &#34;Foo&#34;, &#34;description&#34;: &#34;a list of strings&#34;, &#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {{&#34;type&#34;: &#34;string&#34;}}}}}}, &#34;required&#34;: [&#34;foo&#34;]}}
</span></span></span><span class=line><span class=cl><span class=s2>            the object {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}} is a well-formatted instance of the schema. The object {{&#34;properties&#34;: {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}}}} is not well-formatted.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Here is the output JSON schema:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            </span><span class=si>{OutputSchema}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>                                                
</span></span></span><span class=line><span class=cl><span class=s2>            Do not return any preamble or explanations, return only a pure JSON string surrounded by triple backticks (```).
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Examples:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            question: &#34;What can you tell me about Albert Einstein?&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            context: &#34;Albert Einstein (14 March 1879 â€“ 18 April 1955) was a German-born theoretical physicist, widely held to be one of the greatest and most influential scientists of all time. Best known for developing the theory of relativity, he also made important contributions to quantum mechanics, and was thus a central figure in the revolutionary reshaping of the scientific understanding of nature that modern physics accomplished in the first decades of the twentieth century. His massâ€“energy equivalence formula E = mc2, which arises from relativity theory, has been called &#39;the world&#39;s most famous equation&#39;. He received the 1921 Nobel Prize in Physics &#39;for his services to theoretical physics, and especially for his discovery of the law of the photoelectric effect&#39;, a pivotal step in the development of quantum theory. His work is also known for its influence on the philosophy of science. In a 1999 poll of 130 leading physicists worldwide by the British journal Physics World, Einstein was ranked the greatest physicist of all time. His intellectual achievements and originality have made Einstein synonymous with genius.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer: &#34;Albert Einstein, born on 14 March 1879, was a German-born theoretical physicist, widely held to be one of the greatest and most influential scientists of all time. He received the 1921 Nobel Prize in Physics for his services to theoretical physics.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            verification:
</span></span></span><span class=line><span class=cl><span class=s2>            {{
</span></span></span><span class=line><span class=cl><span class=s2>                &#34;reason&#34;: &#34;The provided context was indeed useful in arriving at the given answer. The context includes key information about Albert Einstein&#39;s life and contributions, which are reflected in the answer.&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>                &#34;verdict&#34;: 1
</span></span></span><span class=line><span class=cl><span class=s2>            }}
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            question: &#34;who won 2020 icc world cup?&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            context: &#34;The 2022 ICC Men&#39;s T20 World Cup, held from October 16 to November 13, 2022, in Australia, was the eighth edition of the tournament. Originally scheduled for 2020, it was postponed due to the COVID-19 pandemic. England emerged victorious, defeating Pakistan by five wickets in the final to clinch their second ICC Men&#39;s T20 World Cup title.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer: &#34;England&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            verification:
</span></span></span><span class=line><span class=cl><span class=s2>            {{
</span></span></span><span class=line><span class=cl><span class=s2>                &#34;reason&#34;: &#34;the context was useful in clarifying the situation regarding the 2020 ICC World Cup and indicating that England was the winner of the tournament that was intended to be held in 2020 but actually took place in 2022.&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>                &#34;verdict&#34;: 1
</span></span></span><span class=line><span class=cl><span class=s2>            }}
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            question: &#34;What is the tallest mountain in the world?&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            context: &#34;The Andes is the longest continental mountain range in the world, located in South America. It stretches across seven countries and features many of the highest peaks in the Western Hemisphere. The range is known for its diverse ecosystems, including the high-altitude Andean Plateau and the Amazon rainforest.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer: &#34;Mount Everest.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            verification:
</span></span></span><span class=line><span class=cl><span class=s2>            {{
</span></span></span><span class=line><span class=cl><span class=s2>                &#34;reason&#34;: &#34;the provided context discusses the Andes mountain range, which, while impressive, does not include Mount Everest or directly relate to the question about the world&#39;s tallest mountain.&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>                &#34;verdict&#34;: 0
</span></span></span><span class=line><span class=cl><span class=s2>            }}
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;human&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            question: &#34;</span><span class=si>{Query}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            context: &#34;</span><span class=si>{Context}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer: &#34;</span><span class=si>{Answer}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            verification:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_v</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>context</span><span class=p>,</span> <span class=n>answer</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>output_schema</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;{&#34;description&#34;: &#34;Answer for the verification task wether the context was useful.&#34;, &#34;type&#34;: &#34;object&#34;, &#34;properties&#34;: {&#34;reason&#34;: {&#34;title&#34;: &#34;Reason&#34;, &#34;description&#34;: &#34;Reason for verification&#34;, &#34;type&#34;: &#34;string&#34;}, &#34;verdict&#34;: {&#34;title&#34;: &#34;Verdict&#34;, &#34;description&#34;: &#34;Binary (0/1) verdict of verification&#34;, &#34;type&#34;: &#34;integer&#34;}}, &#34;required&#34;: [&#34;reason&#34;, &#34;verdict&#34;]}&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>chain</span> <span class=o>=</span> <span class=n>PROMPT</span> <span class=o>|</span> <span class=n>llm</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OutputSchema&#34;</span><span class=p>:</span> <span class=n>output_schema</span><span class=p>,</span> <span class=s2>&#34;Query&#34;</span><span class=p>:</span> <span class=n>query</span><span class=p>,</span> <span class=s2>&#34;Context&#34;</span><span class=p>:</span> <span class=n>context</span><span class=p>,</span> <span class=s2>&#34;Answer&#34;</span><span class=p>:</span> <span class=n>answer</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>content</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>verdict</span> <span class=o>=</span> <span class=n>content</span><span class=p>[</span><span class=s2>&#34;verdict&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>verdict</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>verdict</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>verdicts</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>query</span> <span class=o>=</span> <span class=s2>&#34;è‰¾è²å°”é“å¡”åœ¨å“ªé‡Œ&#34;</span>
</span></span><span class=line><span class=cl><span class=n>contexts</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;åŸƒè²å°”é“å¡”ï¼ˆä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€[3]ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>answer</span> <span class=o>=</span> <span class=s2>&#34;è‰¾è²å°”é“å¡”ä½äºå·´é»&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>context</span> <span class=ow>in</span> <span class=n>contexts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>verdicts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>get_v</span><span class=p>(</span><span class=n>query</span><span class=o>=</span><span class=n>query</span><span class=p>,</span> <span class=n>context</span><span class=o>=</span><span class=n>context</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=n>answer</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Context Precision: &#34;</span><span class=p>,</span> <span class=nb>sum</span><span class=p>(</span><span class=n>verdicts</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>verdicts</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#39;reason&#39;: &#39;æä¾›çš„ä¸Šä¸‹æ–‡ç›´æ¥æè¿°äº†è‰¾è²å°”é“å¡”çš„ä½ç½®ï¼Œæ˜ç¡®è¯´æ˜å®ƒä½äºæ³•å›½å·´é»ï¼Œå› æ­¤ä¸Šä¸‹æ–‡å¯¹äºå¾—å‡ºç­”æ¡ˆæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚&#39;, &#39;verdict&#39;: 1}
</span></span><span class=line><span class=cl>{&#39;reason&#39;: &#39;ä¸Šä¸‹æ–‡æåˆ°è‰¾è²å°”é“å¡”çš„å»ºè®¾å’Œè®¾è®¡å¸ˆï¼Œä½†æ²¡æœ‰ç›´æ¥è¯´æ˜å®ƒçš„ä½ç½®ï¼Œå› æ­¤åœ¨å›ç­”ä¸­æåˆ°è‰¾è²å°”é“å¡”ä½äºå·´é»çš„å†…å®¹æœªå¾—åˆ°ä¸Šä¸‹æ–‡çš„æ”¯æŒã€‚&#39;, &#39;verdict&#39;: 0}
</span></span><span class=line><span class=cl>Context Precision:  0.5
</span></span></code></pre></td></tr></table></div></div><h4 id=context-recall>Context Recall</h4><p>Context Recallï¼ˆä¸Šä¸‹æ–‡å¬å›ç‡ï¼‰ æ˜¯ä¸€ç§ç”¨äºè¯„ä¼°ä¿¡æ¯æ£€ç´¢ç³»ç»Ÿä¸­æ£€ç´¢ç»“æœè¦†ç›–ç¨‹åº¦çš„é‡è¦æŒ‡æ ‡ã€‚å®ƒåæ˜ äº†ç³»ç»Ÿåœ¨ä¸Šä¸‹æ–‡ä¸­æ£€ç´¢åˆ°çš„å†…å®¹ä¸é¢„æœŸä¿¡æ¯ï¼ˆå³ Ground Truthï¼‰ä¹‹é—´çš„åŒ¹é…ç¨‹åº¦ã€‚åœ¨å¼€æ”¾é—®ç­”ç³»ç»Ÿä¸­ï¼ŒGround Truth è¡¨ç¤ºé¢„æœŸç­”æ¡ˆçš„å®Œæ•´å†…å®¹æˆ–å‚è€ƒç­”æ¡ˆã€‚Context Recall çš„è®¡ç®—æµç¨‹æ˜¯é€šè¿‡å°† Ground Truth åˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹çš„è§‚ç‚¹ï¼ˆstatementï¼‰ï¼Œå¹¶åˆ¤æ–­è¿™äº›å¥å­æ˜¯å¦èƒ½åœ¨æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°å¯¹åº”å†…å®¹ã€‚</p><p>Context Recall çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>\[
Context\:Recall = \frac{ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨çš„æ­£ç¡®è§‚ç‚¹æ•°é‡}{Ground Truth çš„æ‰€æœ‰è§‚ç‚¹æ•°é‡}
\]<ul><li>ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨çš„æ­£ç¡®è§‚ç‚¹æ•°é‡ï¼šåœ¨ç»™å®šä¸Šä¸‹æ–‡ä¸­èƒ½å¤Ÿæ‰¾åˆ°æ”¯æŒçš„è§‚ç‚¹çš„æ•°é‡ã€‚</li><li>Ground Truth çš„æ‰€æœ‰è§‚ç‚¹æ•°é‡ï¼šç­”æ¡ˆä¸­æ¶‰åŠçš„æ‰€æœ‰è§‚ç‚¹çš„æ•°é‡ã€‚</li></ul><p><strong>Prompt ç¤ºä¾‹</strong></p><figure><img src=/images/Context%20Recall.png width=90%><figcaption><h4>å›¾ 4. Context Recall Prompt</h4></figcaption></figure><p><strong>Context Recall è®¡ç®—æµç¨‹</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1. æ£€ç´¢ä¸Šä¸‹æ–‡ï¼šä»ä¿¡æ¯æºä¸­è·å–ç›¸å…³ä¸Šä¸‹æ–‡ã€‚
</span></span><span class=line><span class=cl>2. å¤§æ¨¡å‹åˆ¤æ–­ï¼šå°†Query, Context, Ground Truth å¡«å…¥ Prompt äº¤ç»™å¤§æ¨¡å‹ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°åŒ¹é…çš„è§‚ç‚¹(statement)ã€‚
</span></span><span class=line><span class=cl>3. è®¡ç®— Context Recallï¼šæ ¹æ®åˆ†ç±»ä¸º1çš„statementå’Œæ€»statementè®¡ç®—å¬å›ç‡ã€‚
</span></span></code></pre></td></tr></table></div></div><p>ä¸‹å›¾å±•ç¤ºäº† Context Recall çš„è®¡ç®—è¿‡ç¨‹ï¼š</p><figure><img src=/images/Context%20Recall%20Caculate.png width=90%><figcaption><h4>å›¾ 5. Context Recall è®¡ç®—è¿‡ç¨‹</h4></figcaption></figure><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pprint</span> <span class=kn>import</span> <span class=n>pprint</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=n>ChatPromptTemplate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>llm</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>api_key</span><span class=o>=</span><span class=s2>&#34;your_api_key&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-4o-mini&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PROMPT</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;system&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Given a context, and an answer, analyze each sentence in the answer and classify if the sentence can be attributed to the given context or not. Use only &#39;Yes&#39; (1) or &#39;No&#39; (0) as a binary classification. Output json with reason.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            The output should be a well-formatted JSON instance that conforms to the JSON schema below.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            As an example, for the schema {{&#34;properties&#34;: {{&#34;foo&#34;: {{&#34;title&#34;: &#34;Foo&#34;, &#34;description&#34;: &#34;a list of strings&#34;, &#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {{&#34;type&#34;: &#34;string&#34;}}}}}}, &#34;required&#34;: [&#34;foo&#34;]}}
</span></span></span><span class=line><span class=cl><span class=s2>            the object {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}} is a well-formatted instance of the schema. The object {{&#34;properties&#34;: {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}}}} is not well-formatted.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Here is the output JSON schema:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            </span><span class=si>{OutputSchema}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>                                                
</span></span></span><span class=line><span class=cl><span class=s2>            Do not return any preamble or explanations, return only a pure JSON string surrounded by triple backticks (```).
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Examples:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            question: &#34;What can you tell me about albert Albert Einstein?&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            context: &#34;Albert Einstein (14 March 1879 - 18 April 1955) was a German-born theoretical physicist, widely held to be one of the greatest and most influential scientists of all time. Best known for developing the theory of relativity, he also made important contributions to quantum mechanics, and was thus a central figure in the revolutionary reshaping of the scientific understanding of nature that modern physics accomplished in the first decades of the twentieth century. His mass-energy equivalence formula E = mc2, which arises from relativity theory, has been called </span><span class=se>\&#39;</span><span class=s2>the world</span><span class=se>\&#39;</span><span class=s2>s most famous equation</span><span class=se>\&#39;</span><span class=s2>. He received the 1921 Nobel Prize in Physics </span><span class=se>\&#39;</span><span class=s2>for his services to theoretical physics, and especially for his discovery of the law of the photoelectric effect</span><span class=se>\&#39;</span><span class=s2>, a pivotal step in the development of quantum theory. His work is also known for its influence on the philosophy of science. In a 1999 poll of 130 leading physicists worldwide by the British journal Physics World, Einstein was ranked the greatest physicist of all time. His intellectual achievements and originality have made Einstein synonymous with genius.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer: &#34;Albert Einstein born in 14 March 1879 was  German-born theoretical physicist, widely held to be one of the greatest and most influential scientists of all time. He received the 1921 Nobel Prize in Physics for his services to theoretical physics. He published 4 papers in 1905.  Einstein moved to Switzerland in 1895&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            classification: 
</span></span></span><span class=line><span class=cl><span class=s2>            [{{&#34;statement&#34;: &#34;Albert Einstein, born on 14 March 1879, was a German-born theoretical physicist, widely held to be one of the greatest and most influential scientists of all time.&#34;, &#34;attributed&#34;: 1, &#34;reason&#34;: &#34;The date of birth of Einstein is mentioned clearly in the context.&#34;}}, 
</span></span></span><span class=line><span class=cl><span class=s2>            {{&#34;statement&#34;: &#34;He received the 1921 Nobel Prize in Physics for his services to theoretical physics.&#34;, &#34;attributed&#34;: 1, &#34;reason&#34;: &#34;The exact sentence is present in the given context.&#34;}}, 
</span></span></span><span class=line><span class=cl><span class=s2>            {{&#34;statement&#34;: &#34;He published 4 papers in 1905.&#34;, &#34;attributed&#34;: 0, &#34;reason&#34;: &#34;There is no mention about papers he wrote in the given context.&#34;}}, 
</span></span></span><span class=line><span class=cl><span class=s2>            {{&#34;statement&#34;: &#34;Einstein moved to Switzerland in 1895.&#34;, &#34;attributed&#34;: 0, &#34;reason&#34;: &#34;There is no supporting evidence for this in the given context.&#34;}}]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            question: &#34;who won 2020 icc world cup?&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            context: &#34;The 2022 ICC Men</span><span class=se>\&#39;</span><span class=s2>s T20 World Cup, held from October 16 to November 13, 2022, in Australia, was the eighth edition of the tournament. Originally scheduled for 2020, it was postponed due to the COVID-19 pandemic. England emerged victorious, defeating Pakistan by five wickets in the final to clinch their second ICC Men</span><span class=se>\&#39;</span><span class=s2>s T20 World Cup title.&#34;</span><span class=se>\n</span><span class=s2>answer: &#34;England&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            classification: 
</span></span></span><span class=line><span class=cl><span class=s2>            [{{&#34;statement&#34;: &#34;England won the 2022 ICC Men</span><span class=se>\&#39;</span><span class=s2>s T20 World Cup.&#34;, &#34;attributed&#34;: 1, &#34;reason&#34;: &#34;From context it is clear that England defeated Pakistan to win the World Cup.&#34;}}]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            question: &#34;What is the primary fuel for the Sun?&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            context: &#34;NULL&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer: &#34;Hydrogen&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            classification: 
</span></span></span><span class=line><span class=cl><span class=s2>            [{{&#34;statement&#34;: &#34;The Sun</span><span class=se>\&#39;</span><span class=s2>s primary fuel is hydrogen.&#34;, &#34;attributed&#34;: 0, &#34;reason&#34;: &#34;The context contains no information&#34;}}]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;human&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            question: &#34;</span><span class=si>{Query}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            context: &#34;</span><span class=si>{Context}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer: &#34;</span><span class=si>{Answer}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            classification:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_v</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>context</span><span class=p>,</span> <span class=n>answer</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>output_schema</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    {&#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {&#34;$ref&#34;: &#34;#/definitions/ContextRecallClassificationAnswer&#34;}, &#34;definitions&#34;: {&#34;ContextRecallClassificationAnswer&#34;: {&#34;title&#34;: &#34;ContextRecallClassificationAnswer&#34;, &#34;type&#34;: &#34;object&#34;, &#34;properties&#34;: {&#34;statement&#34;: {&#34;title&#34;: &#34;Statement&#34;, &#34;type&#34;: &#34;string&#34;}, &#34;attributed&#34;: {&#34;title&#34;: &#34;Attributed&#34;, &#34;type&#34;: &#34;integer&#34;}, &#34;reason&#34;: {&#34;title&#34;: &#34;Reason&#34;, &#34;type&#34;: &#34;string&#34;}}, &#34;required&#34;: [&#34;statement&#34;, &#34;attributed&#34;, &#34;reason&#34;]}}}
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>chain</span> <span class=o>=</span> <span class=n>PROMPT</span> <span class=o>|</span> <span class=n>llm</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OutputSchema&#34;</span><span class=p>:</span> <span class=n>output_schema</span><span class=p>,</span> <span class=s2>&#34;Query&#34;</span><span class=p>:</span> <span class=n>query</span><span class=p>,</span> <span class=s2>&#34;Context&#34;</span><span class=p>:</span> <span class=n>context</span><span class=p>,</span> <span class=s2>&#34;Answer&#34;</span><span class=p>:</span> <span class=n>answer</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>content</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># verdict = None</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>content</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>classes</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>query</span> <span class=o>=</span> <span class=s2>&#34;è‰¾è²å°”é“å¡”åœ¨å“ªé‡Œ&#34;</span>
</span></span><span class=line><span class=cl><span class=n>contexts</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;åŸƒè²å°”é“å¡”ï¼ˆä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€[3]ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>answer</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”ï¼ˆæ³•è¯­ï¼šTour Eiffelï¼Œ/ËˆaÉªfÉ™l/ [tuÊâ€¿É›fÉ›l] ï¼ˆâ“˜ï¼‰ï¼Œä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€[3]ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©ã€‚æ­£å¼åœ°å€ä¸ºRue Anatole-France 5å·ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚é“å¡”æ˜¯ä¸–ç•Œå»ºç­‘å²ä¸Šçš„æŠ€æœ¯æ°ä½œï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤šäººä»˜è´¹å‚è§‚çš„åèƒœå¤è¿¹ï¼Œè¿™ä¸ªä¸ºäº†ä¸–ç•Œåšè§ˆä¼šè€Œè½æˆçš„é‡‘å±å»ºç­‘ï¼Œ2011å¹´çº¦æœ‰698ä¸‡äººå‚è§‚[4]ï¼Œæ˜¯æ³•å›½å‚è§‚äººæ•°ç¬¬äºŒå¤šçš„æ–‡åŒ–æ™¯ç‚¹ã€‚1986å¹´ç¾å›½åœŸæœ¨å·¥ç¨‹å¸ˆåä¼šå°†è¯¥å»ºç­‘åˆ—å…¥å›½é™…åœŸæœ¨å·¥ç¨‹å†å²å¤è¿¹ï¼Œ1991å¹´ï¼ŒåŸƒè²å°”é“å¡”è¿åŒå·´é»å¡çº³æ²³æ²¿å²¸æ•´åº§è¢«åˆ—å…¥ä¸–ç•Œé—äº§ã€‚[5]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”ä»¥312ç±³çš„é«˜åº¦ï¼Œå æ®ä¸–ç•Œæœ€é«˜äººé€ å»ºç­‘çš„ä½ç½®é•¿è¾¾å››åå¹´ï¼Œç›´åˆ°çº½çº¦å…‹è±æ–¯å‹’å¤§æ¥¼çš„å‡ºç°ï¼Œå…¶ä½äº279.11ç±³å¤„çš„è§‚æ™¯å¹³å°æ˜¯æ¬§ç›ŸèŒƒå›´å†…å…¬ä¼—èƒ½å¤ŸæŠµè¾¾çš„æœ€é«˜çš„è§‚æ™¯å°ï¼Œåœ¨å…¨æ¬§æ´²èŒƒå›´å†…ä»…æ¬¡äºè«æ–¯ç§‘çš„å¥¥æ–¯å¦é‡‘è¯ºç”µè§†å¡”ã€‚é“å¡”çš„æ€»é«˜åº¦æ›¾é€šè¿‡å®‰è£…å¤©çº¿è€Œå¤šæ¬¡æé«˜ã€‚è¿™äº›å¤©çº¿æ›¾è¢«ç”¨äºè®¸å¤šç§‘å­¦å®éªŒï¼Œç°åœ¨ä¸»è¦ç”¨äºå‘å°„å¹¿æ’­ç”µè§†ä¿¡å·ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>get_v</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=s2>&#34;.&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>contexts</span><span class=p>),</span> <span class=n>answer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pprint</span><span class=p>(</span><span class=n>result</span><span class=p>[:</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>res</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>classes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=s2>&#34;attributed&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Context Recall: &#34;</span><span class=p>,</span> <span class=nb>sum</span><span class=p>(</span><span class=n>classes</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>classes</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[{&#39;attributed&#39;: 1,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;This statement is directly supported by the context, which &#39;
</span></span><span class=line><span class=cl>            &#34;describes the Eiffel Tower&#39;s location and significance.&#34;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;åŸƒè²å°”é“å¡”ï¼ˆæ³•è¯­ï¼šTour Eiffelï¼Œ/ËˆaÉªfÉ™l/ [tuÊâ€¿É›fÉ›l] &#39;
</span></span><span class=line><span class=cl>               &#39;ï¼ˆâ“˜ï¼‰ï¼Œä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;The context does not mention this specific address.&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;æ­£å¼åœ°å€ä¸ºRue Anatole-France 5å·ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 1,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;This information is directly stated in the context.&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#34;While the context discusses the Eiffel Tower&#39;s significance, it &#34;
</span></span><span class=line><span class=cl>            &#39;does not specifically refer to it as a technological masterpiece &#39;
</span></span><span class=line><span class=cl>            &#39;or the most visited paid monument.&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;é“å¡”æ˜¯ä¸–ç•Œå»ºç­‘å²ä¸Šçš„æŠ€æœ¯æ°ä½œï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤šäººä»˜è´¹å‚è§‚çš„åèƒœå¤è¿¹ï¼Œ&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;The context does not provide specific visitor statistics or &#39;
</span></span><span class=line><span class=cl>            &#39;ranking.&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;è¿™ä¸ªä¸ºäº†ä¸–ç•Œåšè§ˆä¼šè€Œè½æˆçš„é‡‘å±å»ºç­‘ï¼Œ2011å¹´çº¦æœ‰698ä¸‡äººå‚è§‚ï¼Œæ˜¯æ³•å›½å‚è§‚äººæ•°ç¬¬äºŒå¤šçš„æ–‡åŒ–æ™¯ç‚¹ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;The context does not mention the inclusion in engineering history &#39;
</span></span><span class=line><span class=cl>            &#39;landmarks or UNESCO World Heritage status.&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;1986å¹´ç¾å›½åœŸæœ¨å·¥ç¨‹å¸ˆåä¼šå°†è¯¥å»ºç­‘åˆ—å…¥å›½é™…åœŸæœ¨å·¥ç¨‹å†å²å¤è¿¹ï¼Œ1991å¹´ï¼ŒåŸƒè²å°”é“å¡”è¿åŒå·´é»å¡çº³æ²³æ²¿å²¸æ•´åº§è¢«åˆ—å…¥ä¸–ç•Œé—äº§ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;The context does not provide specific height or duration of being &#39;
</span></span><span class=line><span class=cl>            &#39;the tallest man-made structure.&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;åŸƒè²å°”é“å¡”ä»¥312ç±³çš„é«˜åº¦ï¼Œå æ®ä¸–ç•Œæœ€é«˜äººé€ å»ºç­‘çš„ä½ç½®é•¿è¾¾å››åå¹´ï¼Œ&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;The context does not mention the installation of antennas or &#39;
</span></span><span class=line><span class=cl>            &#39;height increases.&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;é“å¡”çš„æ€»é«˜åº¦æ›¾é€šè¿‡å®‰è£…å¤©çº¿è€Œå¤šæ¬¡æé«˜ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;There is no mention of antennas being used for scientific &#39;
</span></span><span class=line><span class=cl>            &#39;experiments or broadcasting.&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;è¿™äº›å¤©çº¿æ›¾è¢«ç”¨äºè®¸å¤šç§‘å­¦å®éªŒï¼Œç°åœ¨ä¸»è¦ç”¨äºå‘å°„å¹¿æ’­ç”µè§†ä¿¡å·ã€‚&#39;}]
</span></span><span class=line><span class=cl>Context Recall:  0.2222222222222222
</span></span><span class=line><span class=cl>â¯ python scripts/context_recall.py
</span></span><span class=line><span class=cl>[{&#39;attributed&#39;: 1,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;è¯¥å¥æè¿°äº†åŸƒè²å°”é“å¡”çš„ä½ç½®å’Œå…¶é‡è¦æ€§ï¼Œä¸ä¸Šä¸‹æ–‡ä¸€è‡´ã€‚&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;åŸƒè²å°”é“å¡”ï¼ˆæ³•è¯­ï¼šTour Eiffelï¼Œ/ËˆaÉªfÉ™l/ [tuÊâ€¿É›fÉ›l] &#39;
</span></span><span class=line><span class=cl>               &#39;ï¼ˆâ“˜ï¼‰ï¼Œä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;ä¸Šä¸‹æ–‡ä¸­å¹¶æœªæåŠåŸƒè²å°”é“å¡”çš„å…·ä½“åœ°å€ã€‚&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;æ­£å¼åœ°å€ä¸ºRue Anatole-France 5å·ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 1,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;è¯¥å¥ä¸­çš„ä¿¡æ¯ä¸ä¸Šä¸‹æ–‡ä¸€è‡´ï¼Œæ˜ç¡®æåˆ°å…¶å»ºæˆæ—¶é—´å’Œå‘½åã€‚&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;ä¸Šä¸‹æ–‡æ²¡æœ‰æåˆ°å…³äºå‚è§‚äººæ•°æˆ–å…¶ä½œä¸ºæŠ€æœ¯æ°ä½œçš„å…·ä½“æè¿°ã€‚&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;é“å¡”æ˜¯ä¸–ç•Œå»ºç­‘å²ä¸Šçš„æŠ€æœ¯æ°ä½œï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤šäººä»˜è´¹å‚è§‚çš„åèƒœå¤è¿¹ï¼Œè¿™ä¸ªä¸ºäº†ä¸–ç•Œåšè§ˆä¼šè€Œè½æˆçš„é‡‘å±å»ºç­‘ï¼Œ2011å¹´çº¦æœ‰698ä¸‡äººå‚è§‚ï¼Œæ˜¯æ³•å›½å‚è§‚äººæ•°ç¬¬äºŒå¤šçš„æ–‡åŒ–æ™¯ç‚¹ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;ä¸Šä¸‹æ–‡æœªæåŠå…³äºå»ºç­‘çš„å†å²é—äº§åœ°ä½çš„ä¿¡æ¯ã€‚&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;1986å¹´ç¾å›½åœŸæœ¨å·¥ç¨‹å¸ˆåä¼šå°†è¯¥å»ºç­‘åˆ—å…¥å›½é™…åœŸæœ¨å·¥ç¨‹å†å²å¤è¿¹ï¼Œ1991å¹´ï¼ŒåŸƒè²å°”é“å¡”è¿åŒå·´é»å¡çº³æ²³æ²¿å²¸æ•´åº§è¢«åˆ—å…¥ä¸–ç•Œé—äº§ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰æåˆ°åŸƒè²å°”é“å¡”çš„é«˜åº¦æˆ–å…¶å†å²åœ°ä½ã€‚&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;åŸƒè²å°”é“å¡”ä»¥312ç±³çš„é«˜åº¦ï¼Œå æ®ä¸–ç•Œæœ€é«˜äººé€ å»ºç­‘çš„ä½ç½®é•¿è¾¾å››åå¹´ï¼Œç›´åˆ°çº½çº¦å…‹è±æ–¯å‹’å¤§æ¥¼çš„å‡ºç°ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;ä¸Šä¸‹æ–‡æ²¡æœ‰åŒ…å«å…³äºè§‚æ™¯å¹³å°çš„é«˜åº¦æˆ–æ’åçš„ä¿¡æ¯ã€‚&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;å…¶ä½äº279.11ç±³å¤„çš„è§‚æ™¯å¹³å°æ˜¯æ¬§ç›ŸèŒƒå›´å†…å…¬ä¼—èƒ½å¤ŸæŠµè¾¾çš„æœ€é«˜çš„è§‚æ™¯å°ï¼Œåœ¨å…¨æ¬§æ´²èŒƒå›´å†…ä»…æ¬¡äºè«æ–¯ç§‘çš„å¥¥æ–¯å¦é‡‘è¯ºç”µè§†å¡”ã€‚&#39;},
</span></span><span class=line><span class=cl> {&#39;attributed&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;reason&#39;: &#39;ä¸Šä¸‹æ–‡æ²¡æœ‰æåŠå¤©çº¿æˆ–ç§‘å­¦å®éªŒç›¸å…³çš„ä¿¡æ¯ã€‚&#39;,
</span></span><span class=line><span class=cl>  &#39;statement&#39;: &#39;é“å¡”çš„æ€»é«˜åº¦æ›¾é€šè¿‡å®‰è£…å¤©çº¿è€Œå¤šæ¬¡æé«˜ã€‚è¿™äº›å¤©çº¿æ›¾è¢«ç”¨äºè®¸å¤šç§‘å­¦å®éªŒï¼Œç°åœ¨ä¸»è¦ç”¨äºå‘å°„å¹¿æ’­ç”µè§†ä¿¡å·ã€‚&#39;}]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Context Recall:  0.25
</span></span></code></pre></td></tr></table></div></div><h4 id=context-entities-recall>Context Entities Recall</h4><p>Context Entities Recallï¼ˆä¸Šä¸‹æ–‡å®ä½“å¬å›ç‡ï¼‰æ˜¯ä¸€ç§ç”¨äºè¯„ä¼°æ£€ç´¢è¿‡ç¨‹çš„æŒ‡æ ‡ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯æ¯”è¾ƒæ¨¡å‹åœ¨ç»™å®šä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ä¸çœŸå®ç­”æ¡ˆï¼ˆGround Truthï¼‰ä¸­æŠ½å–åˆ°çš„å®ä½“ï¼Œå¹¶è®¡ç®—Ground Truthä¸­å®ä½“çš„å¬å›ç‡ã€‚è¯¥æŒ‡æ ‡èƒ½å¤Ÿæœ‰æ•ˆè¯„ä¼°æ£€ç´¢ç»“æœå¯¹äºå…³é”®ä¿¡æ¯çš„å¬å›ç‡ã€‚</p><p>Context Entities Recallçš„è®¡ç®—å…¬å¼ä¸ºï¼š</p>\[
Context\:Entities\:Recall = \frac{ä¸Šä¸‹æ–‡ä¸­å®ä½“ \cap çœŸå®ç­”æ¡ˆä¸­å®ä½“}{çœŸå®ç­”æ¡ˆä¸­å®ä½“}
\]<ul><li>ä¸Šä¸‹æ–‡ä¸­å®ä½“ï¼šæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä¸­å®ä½“é›†åˆ</li><li>çœŸå®ç­”æ¡ˆä¸­å®ä½“ï¼šçœŸå®ç­”æ¡ˆä¸­å®ä½“é›†åˆ</li></ul><p>å…¶ä¸­å®ä½“æŠ½å–ä¸»è¦æ˜¯ä½¿ç”¨å¤§æ¨¡å‹è¿›è¡Œè§£æï¼Œä¸‹é¢æ˜¯å®ä½“æŠ½å–çš„Prompt</p><figure><img src=/images/Context%20Entity%20Recall.png width=90%><figcaption><h4>å›¾ 6. Context Entities Recall Prompt</h4></figcaption></figure><p>ä¸‹å›¾å±•ç¤ºäº†<code>Context Entites Recall</code>è®¡ç®—è¿‡ç¨‹</p><figure><img src=/images/Context%20Entity%20Recall%20Caculate.png width=90%><figcaption><h4>å›¾ 7. Context Entities Recall è®¡ç®—è¿‡ç¨‹</h4></figcaption></figure><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pprint</span> <span class=kn>import</span> <span class=n>pprint</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=n>ChatPromptTemplate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>llm</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-4o-mini&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PROMPT</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;system&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Given a text, extract unique entities without repetition. Ensure you consider different forms or mentions of the same entity as a single entity.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            The output should be a well-formatted JSON instance that conforms to the JSON schema below.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            As an example, for the schema {{&#34;properties&#34;: {{&#34;foo&#34;: {{&#34;title&#34;: &#34;Foo&#34;, &#34;description&#34;: &#34;a list of strings&#34;, &#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {{&#34;type&#34;: &#34;string&#34;}}}}}}, &#34;required&#34;: [&#34;foo&#34;]}}
</span></span></span><span class=line><span class=cl><span class=s2>            the object {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}} is a well-formatted instance of the schema. The object {{&#34;properties&#34;: {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}}}} is not well-formatted.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Here is the output JSON schema:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            </span><span class=si>{OutputSchema}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>                                                
</span></span></span><span class=line><span class=cl><span class=s2>            Do not return any preamble or explanations, return only a pure JSON string surrounded by triple backticks (```).
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Examples:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            text: &#34;The Eiffel Tower, located in Paris, France, is one of the most iconic landmarks globally. Millions of visitors are attracted to it each year for its breathtaking views of the city. Completed in 1889, it was constructed in time for the 1889 World</span><span class=se>\&#39;</span><span class=s2>s Fair.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            output: 
</span></span></span><span class=line><span class=cl><span class=s2>            {{&#34;entities&#34;: [&#34;Eiffel Tower&#34;, &#34;Paris&#34;, &#34;France&#34;, &#34;1889&#34;, &#34;World</span><span class=se>\&#39;</span><span class=s2>s Fair&#34;]}}
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            text: &#34;The Colosseum in Rome, also known as the Flavian Amphitheatre, stands as a monument to Roman architectural and engineering achievement. Construction began under Emperor Vespasian in AD 70 and was completed by his son Titus in AD 80. It could hold between 50,000 and 80,000 spectators who watched gladiatorial contests and public spectacles.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            output:
</span></span></span><span class=line><span class=cl><span class=s2>            {{&#34;entities&#34;: [&#34;Colosseum&#34;, &#34;Rome&#34;, &#34;Flavian Amphitheatre&#34;, &#34;Vespasian&#34;, &#34;AD 70&#34;, &#34;Titus&#34;, &#34;AD 80&#34;]}}
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            text: &#34;The Great Wall of China, stretching over 21,196 kilometers from east to west, is a marvel of ancient defensive architecture.Built to protect against invasions from the north, its construction started as early as the 7th century BC. Today, it is a UNESCO World Heritage Site and a major tourist attraction.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            output: 
</span></span></span><span class=line><span class=cl><span class=s2>            {{&#34;entities&#34;: [&#34;Great Wall of China&#34;, &#34;21,196 kilometers&#34;, &#34;7th century BC&#34;, &#34;UNESCO World Heritage Site&#34;]}}
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            text: &#34;The Apollo 11 mission, which launched on July 16, 1969, marked the first time humans landed on the Moon.Astronauts Neil Armstrong, Buzz Aldrin, and Michael Collins made history, with Armstrong being the first man to step on the lunar surface.         This event was a significant milestone in space exploration.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            output: 
</span></span></span><span class=line><span class=cl><span class=s2>            {{&#34;entities&#34;: [&#34;Apollo 11 mission&#34;, &#34;July 16, 1969&#34;, &#34;Moon&#34;, &#34;Neil Armstrong&#34;, &#34;Buzz Aldrin&#34;, &#34;Michael Collins&#34;]}}
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;human&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            text: &#34;</span><span class=si>{Text}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            output:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_v</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>output_schema</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    {&#34;type&#34;: &#34;object&#34;, &#34;properties&#34;: {&#34;entities&#34;: {&#34;title&#34;: &#34;Entities&#34;, &#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {&#34;type&#34;: &#34;string&#34;}}}, &#34;required&#34;: [&#34;entities&#34;]}
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>chain</span> <span class=o>=</span> <span class=n>PROMPT</span> <span class=o>|</span> <span class=n>llm</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OutputSchema&#34;</span><span class=p>:</span> <span class=n>output_schema</span><span class=p>,</span> <span class=s2>&#34;Text&#34;</span><span class=p>:</span> <span class=n>text</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>content</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># verdict = None</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>content</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>classes</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>query</span> <span class=o>=</span> <span class=s2>&#34;è‰¾è²å°”é“å¡”åœ¨å“ªé‡Œ&#34;</span>
</span></span><span class=line><span class=cl><span class=n>contexts</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;åŸƒè²å°”é“å¡”ï¼ˆä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€[3]ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>answer</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”ï¼ˆæ³•è¯­ï¼šTour Eiffelï¼Œ/ËˆaÉªfÉ™l/ [tuÊâ€¿É›fÉ›l] ï¼ˆâ“˜ï¼‰ï¼Œä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€[3]ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©ã€‚æ­£å¼åœ°å€ä¸ºRue Anatole-France 5å·ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚é“å¡”æ˜¯ä¸–ç•Œå»ºç­‘å²ä¸Šçš„æŠ€æœ¯æ°ä½œï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤šäººä»˜è´¹å‚è§‚çš„åèƒœå¤è¿¹ï¼Œè¿™ä¸ªä¸ºäº†ä¸–ç•Œåšè§ˆä¼šè€Œè½æˆçš„é‡‘å±å»ºç­‘ï¼Œ2011å¹´çº¦æœ‰698ä¸‡äººå‚è§‚[4]ï¼Œæ˜¯æ³•å›½å‚è§‚äººæ•°ç¬¬äºŒå¤šçš„æ–‡åŒ–æ™¯ç‚¹ã€‚1986å¹´ç¾å›½åœŸæœ¨å·¥ç¨‹å¸ˆåä¼šå°†è¯¥å»ºç­‘åˆ—å…¥å›½é™…åœŸæœ¨å·¥ç¨‹å†å²å¤è¿¹ï¼Œ1991å¹´ï¼ŒåŸƒè²å°”é“å¡”è¿åŒå·´é»å¡çº³æ²³æ²¿å²¸æ•´åº§è¢«åˆ—å…¥ä¸–ç•Œé—äº§ã€‚[5]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”ä»¥312ç±³çš„é«˜åº¦ï¼Œå æ®ä¸–ç•Œæœ€é«˜äººé€ å»ºç­‘çš„ä½ç½®é•¿è¾¾å››åå¹´ï¼Œç›´åˆ°çº½çº¦å…‹è±æ–¯å‹’å¤§æ¥¼çš„å‡ºç°ï¼Œå…¶ä½äº279.11ç±³å¤„çš„è§‚æ™¯å¹³å°æ˜¯æ¬§ç›ŸèŒƒå›´å†…å…¬ä¼—èƒ½å¤ŸæŠµè¾¾çš„æœ€é«˜çš„è§‚æ™¯å°ï¼Œåœ¨å…¨æ¬§æ´²èŒƒå›´å†…ä»…æ¬¡äºè«æ–¯ç§‘çš„å¥¥æ–¯å¦é‡‘è¯ºç”µè§†å¡”ã€‚é“å¡”çš„æ€»é«˜åº¦æ›¾é€šè¿‡å®‰è£…å¤©çº¿è€Œå¤šæ¬¡æé«˜ã€‚è¿™äº›å¤©çº¿æ›¾è¢«ç”¨äºè®¸å¤šç§‘å­¦å®éªŒï¼Œç°åœ¨ä¸»è¦ç”¨äºå‘å°„å¹¿æ’­ç”µè§†ä¿¡å·ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>result_context</span> <span class=o>=</span> <span class=n>get_v</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>contexts</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>pprint</span><span class=p>(</span><span class=n>result_context</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>result_answer</span> <span class=o>=</span> <span class=n>get_v</span><span class=p>(</span><span class=n>answer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pprint</span><span class=p>(</span><span class=n>result_answer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>compute_score</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>ground_truth_entities</span><span class=p>,</span> <span class=n>context_entities</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>num_entities_in_both</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nb>set</span><span class=p>(</span><span class=n>context_entities</span><span class=p>)</span><span class=o>.</span><span class=n>intersection</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>ground_truth_entities</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>num_entities_in_both</span> <span class=o>/</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>ground_truth_entities</span><span class=p>)</span> <span class=o>+</span> <span class=mf>1e-8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># for res in result:</span>
</span></span><span class=line><span class=cl><span class=c1>#     classes.append(res[&#34;attributed&#34;])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Context Entites Recall: &#34;</span><span class=p>,</span> <span class=n>compute_score</span><span class=p>(</span><span class=n>result_answer</span><span class=p>[</span><span class=s2>&#34;entities&#34;</span><span class=p>],</span> <span class=n>result_context</span><span class=p>[</span><span class=s2>&#34;entities&#34;</span><span class=p>]))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#39;entities&#39;: [&#39;åŸƒè²å°”é“å¡”&#39;,
</span></span><span class=line><span class=cl>              &#39;å·´é»é“å¡”&#39;,
</span></span><span class=line><span class=cl>              &#39;æ³•å›½&#39;,
</span></span><span class=line><span class=cl>              &#39;å·´é»&#39;,
</span></span><span class=line><span class=cl>              &#39;å¡çº³æ²³&#39;,
</span></span><span class=line><span class=cl>              &#39;æˆ˜ç¥å¹¿åœº&#39;,
</span></span><span class=line><span class=cl>              &#39;å±…æ–¯å¡”å¤«Â·åŸƒè²å°”&#39;,
</span></span><span class=line><span class=cl>              &#39;1889å¹´&#39;,
</span></span><span class=line><span class=cl>              &#39;ä¸‰ç™¾ç±³å¡”&#39;]}
</span></span><span class=line><span class=cl>{&#39;entities&#39;: [&#39;åŸƒè²å°”é“å¡”&#39;,
</span></span><span class=line><span class=cl>              &#39;æ³•è¯­&#39;,
</span></span><span class=line><span class=cl>              &#39;å·´é»é“å¡”&#39;,
</span></span><span class=line><span class=cl>              &#39;æ³•å›½&#39;,
</span></span><span class=line><span class=cl>              &#39;å·´é»&#39;,
</span></span><span class=line><span class=cl>              &#39;å¡çº³æ²³&#39;,
</span></span><span class=line><span class=cl>              &#39;æˆ˜ç¥å¹¿åœº&#39;,
</span></span><span class=line><span class=cl>              &#39;1889å¹´&#39;,
</span></span><span class=line><span class=cl>              &#39;å±…æ–¯å¡”å¤«Â·åŸƒè²å°”&#39;,
</span></span><span class=line><span class=cl>              &#39;å›½é™…åœŸæœ¨å·¥ç¨‹å†å²å¤è¿¹&#39;,
</span></span><span class=line><span class=cl>              &#39;1991å¹´&#39;,
</span></span><span class=line><span class=cl>              &#39;ä¸–ç•Œé—äº§&#39;,
</span></span><span class=line><span class=cl>              &#39;312ç±³&#39;,
</span></span><span class=line><span class=cl>              &#39;çº½çº¦&#39;,
</span></span><span class=line><span class=cl>              &#39;å…‹è±æ–¯å‹’å¤§æ¥¼&#39;,
</span></span><span class=line><span class=cl>              &#39;279.11ç±³&#39;,
</span></span><span class=line><span class=cl>              &#39;æ¬§ç›Ÿ&#39;,
</span></span><span class=line><span class=cl>              &#39;è«æ–¯ç§‘&#39;,
</span></span><span class=line><span class=cl>              &#39;å¥¥æ–¯å¦é‡‘è¯ºç”µè§†å¡”&#39;,
</span></span><span class=line><span class=cl>              &#39;å¹¿æ’­ç”µè§†ä¿¡å·&#39;]}
</span></span><span class=line><span class=cl>Context Entites Recall:  0.3999999998
</span></span></code></pre></td></tr></table></div></div><h4 id=answer-correctness>Answer Correctness</h4><p>Answer Correctnessï¼ˆç­”æ¡ˆå‡†ç¡®æ€§ï¼‰ æ˜¯ä¸€ç§ç”¨äºè¯„ä¼° RAGï¼ˆRetrieval-Augmented Generationï¼‰åº”ç”¨ç”Ÿæˆçš„ç­”æ¡ˆå‡†ç¡®æ€§çš„æŒ‡æ ‡ã€‚å…¶ç›®æ ‡æ˜¯è¡¡é‡æ¨¡å‹ç”Ÿæˆçš„ç­”æ¡ˆä¸çœŸå®ç­”æ¡ˆï¼ˆGround Truthï¼‰ä¹‹é—´çš„åŒ¹é…ç¨‹åº¦ï¼Œä»è€Œåˆ¤æ–­æ¨¡å‹æ˜¯å¦ç”Ÿæˆäº†æ­£ç¡®ä¸”æœ‰æ”¯æŒçš„å†…å®¹ã€‚æŒ‡æ ‡ç»“åˆäº†ç»å…¸çš„åˆ†ç±»è¯„ä»·æ–¹æ³•ï¼Œå°†ç”Ÿæˆçš„ç­”æ¡ˆåˆ†ä¸ºæ­£ç¡®è¯†åˆ«ï¼ˆTPï¼‰ã€é”™è¯¯è¯†åˆ«ï¼ˆFPï¼‰å’Œé—æ¼ï¼ˆFNï¼‰ï¼Œå¸®åŠ©RAGåº”ç”¨å›ç­”çš„å‡†ç¡®æ€§ã€‚</p><ol><li>TPï¼ˆTrue Positiveï¼Œæ­£ç¡®è¯†åˆ«ï¼‰ï¼š</li></ol><ul><li>å®šä¹‰ï¼šç­”æ¡ˆä¸­çš„è¯­å¥ä¸çœŸå®ç­”æ¡ˆä¸­çš„è¯­å¥åŒ¹é…ï¼Œä¸”å¾—åˆ°äº†çœŸå®ç­”æ¡ˆçš„æ˜ç¡®æ”¯æŒã€‚</li><li>ä½œç”¨ï¼šè¯†åˆ«å‡ºæ¨¡å‹æ­£ç¡®ç”Ÿæˆçš„ä¿¡æ¯ã€‚</li></ul><ol start=2><li>FPï¼ˆFalse Positiveï¼Œé”™è¯¯è¯†åˆ«ï¼‰ï¼š</li></ol><ul><li>å®šä¹‰ï¼šç­”æ¡ˆä¸­å‡ºç°äº†æ²¡æœ‰çœŸå®ç­”æ¡ˆæ”¯æŒçš„è¯­å¥ï¼Œå³é”™è¯¯ä¿¡æ¯æˆ–ä¸ç›¸å…³å†…å®¹ã€‚</li><li>ä½œç”¨ï¼šæ£€æµ‹æ¨¡å‹ç”Ÿæˆçš„æ— æ ¹æ®æˆ–é”™è¯¯ä¿¡æ¯ã€‚</li></ul><ol start=3><li>FNï¼ˆFalse Negativeï¼Œé—æ¼ï¼‰ï¼š</li></ol><ul><li>å®šä¹‰ï¼šçœŸå®ç­”æ¡ˆä¸­çš„è¯­å¥æœªå‡ºç°åœ¨ç”Ÿæˆçš„ç­”æ¡ˆä¸­ï¼Œå³æ¨¡å‹æ¼æ‰çš„é‡è¦ä¿¡æ¯ã€‚</li><li>ä½œç”¨ï¼šè¯„ä¼°æ¨¡å‹åœ¨å›ç­”æ—¶æ˜¯å¦é—æ¼äº†å…³é”®ä¿¡æ¯ã€‚</li></ul><p>Answer Correctness è®¡ç®—å…¬å¼</p>\[
\text{Answer Correctness} = \frac{|\text{TP}|}{|\text{TP} + 0.5 * (\text{FP} + \text{FN})|}
\]<p>å…¶ä¸­å¤§æ¨¡å‹åˆ†ç±»çš„Promptå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure><img src=/images/Answer%20Correctness.png width=90%><figcaption><h4>å›¾ 8. Answer Correctness Prompt</h4></figcaption></figure><p>Answer Correctness æ˜¯ä¸€ä¸ªåŠ æƒçš„è¯„ä¼°æŒ‡æ ‡ï¼ŒåŒæ ·çš„æ ¹æ®RAGåº”ç”¨å›ç­”åˆ†ç±»ä¹Ÿå¯ä»¥è®¡ç®—ä¸‹é¢çš„å‡ ä¸ªæŒ‡æ ‡ï¼š</p><ol><li><p>ç²¾å‡†ç‡ï¼ˆPrecisionï¼‰ï¼šåæ˜ ç”Ÿæˆçš„ç­”æ¡ˆä¸­ï¼Œæœ‰å¤šå°‘æ¯”ä¾‹æ˜¯æ­£ç¡®çš„å†…å®¹ã€‚</p>\[
\text{Precision} = \frac{|\text{TP}|}{|\text{TP} + \text{FP}|}
\]</li><li><p>å¬å›ç‡ï¼ˆRecallï¼‰ï¼šåæ˜ çœŸå®ç­”æ¡ˆä¸­çš„ä¿¡æ¯æœ‰å¤šå°‘è¢«æ¨¡å‹è¯†åˆ«å¹¶ç”Ÿæˆã€‚</p>\[
\text{Recall} = \frac{|\text{TP}|}{|\text{TP} + \text{FN}|}
\]</li><li><p>F1åˆ†æ•°ï¼ˆF1 Scoreï¼‰ï¼šç»“åˆäº†ç²¾å‡†ç‡å’Œå¬å›ç‡çš„å¹³è¡¡æŒ‡æ ‡ï¼Œä½œä¸ºæ•´ä½“è¯„ä»·ã€‚</p>\[
F1 = 2 \times \frac{\text{Precision} \times \text{Recall}}{\text{Precision} + \text{Recall}}
\]</li></ol><figure><img src=/images/Answer%20Correctness%20Caculate.png width=90%><figcaption><h4>å›¾ 9. Answer Correctness è®¡ç®—è¿‡ç¨‹</h4></figcaption></figure><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pprint</span> <span class=kn>import</span> <span class=n>pprint</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=n>ChatPromptTemplate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>llm</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-4o-mini&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PROMPT</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;system&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Given a ground truth and an answer statements, analyze each statement and classify them in one of the following categories:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            - TP (true positive): statements that are present in answer that are also directly supported by the one or more statements in ground truth,
</span></span></span><span class=line><span class=cl><span class=s2>            - FP (false positive): statements present in the answer but not directly supported by any statement in ground truth,
</span></span></span><span class=line><span class=cl><span class=s2>            - FN (false negative): statements found in the ground truth but not present in answer.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Each statement can only belong to one of the categories. Provide a reason for each classification.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            The output should be a well-formatted JSON instance that conforms to the JSON schema below.
</span></span></span><span class=line><span class=cl><span class=s2>            As an example, for the schema {{&#34;properties&#34;: {{&#34;foo&#34;: {{&#34;title&#34;: &#34;Foo&#34;, &#34;description&#34;: &#34;a list of strings&#34;, &#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {{&#34;type&#34;: &#34;string&#34;}}}}}}, &#34;required&#34;: [&#34;foo&#34;]}}
</span></span></span><span class=line><span class=cl><span class=s2>            the object {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}} is a well-formatted instance of the schema. The object {{&#34;properties&#34;: {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}}}} is not well-formatted.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Here is the output JSON schema:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            </span><span class=si>{OutputSchema}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>                                                
</span></span></span><span class=line><span class=cl><span class=s2>            Do not return any preamble or explanations, return only a pure JSON string surrounded by triple backticks (```).
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Examples:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            question: &#34;What powers the sun and what is its primary function?&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer: 
</span></span></span><span class=line><span class=cl><span class=s2>            [&#34;The sun is powered by nuclear fission, similar to nuclear reactors on Earth.&#34;, &#34;The primary function of the sun is to provide light to the solar system.&#34;]
</span></span></span><span class=line><span class=cl><span class=s2>            ground_truth: 
</span></span></span><span class=line><span class=cl><span class=s2>            [&#34;The sun is powered by nuclear fusion, where hydrogen atoms fuse to form helium.&#34;, &#34;This fusion process in the sun</span><span class=se>\&#39;</span><span class=s2>s core releases a tremendous amount of energy.&#34;, &#34;The energy from the sun provides heat and light, which are essential for life on Earth.&#34;, &#34;The sun</span><span class=se>\&#39;</span><span class=s2>s light plays a critical role in Earth</span><span class=se>\&#39;</span><span class=s2>s climate system.&#34;, &#34;Sunlight helps to drive the weather and ocean currents.&#34;]
</span></span></span><span class=line><span class=cl><span class=s2>            classification: 
</span></span></span><span class=line><span class=cl><span class=s2>            {{&#34;TP&#34;: [{{&#34;statement&#34;: &#34;The primary function of the sun is to provide light to the solar system.&#34;, &#34;reason&#34;: &#34;This statement is somewhat supported by the ground truth mentioning the sun providing light and its roles, though it focuses more broadly on the sun</span><span class=se>\&#39;</span><span class=s2>s energy.&#34;}}], &#34;FP&#34;: [{{&#34;statement&#34;: &#34;The sun is powered by nuclear fission, similar to nuclear reactors on Earth.&#34;, &#34;reason&#34;: &#34;This statement is incorrect and contradicts the ground truth which states that the sun is powered by nuclear fusion.&#34;}}], &#34;FN&#34;: [{{&#34;statement&#34;: &#34;The sun is powered by nuclear fusion, where hydrogen atoms fuse to form helium.&#34;, &#34;reason&#34;: &#34;This accurate description of the sunâ€™s power source is not included in the answer.&#34;}}, {{&#34;statement&#34;: &#34;This fusion process in the sun</span><span class=se>\&#39;</span><span class=s2>s core releases a tremendous amount of energy.&#34;, &#34;reason&#34;: &#34;This process and its significance are not mentioned in the answer.&#34;}}, {{&#34;statement&#34;: &#34;The energy from the sun provides heat and light, which are essential for life on Earth.&#34;, &#34;reason&#34;: &#34;The answer only mentions light, omitting the essential aspects of heat and its necessity for life, which the ground truth covers.&#34;}}, {{&#34;statement&#34;: &#34;The sun</span><span class=se>\&#39;</span><span class=s2>s light plays a critical role in Earth</span><span class=se>\&#39;</span><span class=s2>s climate system.&#34;, &#34;reason&#34;: &#34;This broader impact of the sunâ€™s light on Earth</span><span class=se>\&#39;</span><span class=s2>s climate system is not addressed in the answer.&#34;}}, {{&#34;statement&#34;: &#34;Sunlight helps to drive the weather and ocean currents.&#34;, &#34;reason&#34;: &#34;The effect of sunlight on weather patterns and ocean currents is omitted in the answer.&#34;}}]}}
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            question: &#34;What is the boiling point of water?&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer: 
</span></span></span><span class=line><span class=cl><span class=s2>            [&#34;The boiling point of water is 100 degrees Celsius at sea level&#34;]
</span></span></span><span class=line><span class=cl><span class=s2>            ground_truth: 
</span></span></span><span class=line><span class=cl><span class=s2>            [&#34;The boiling point of water is 100 degrees Celsius (212 degrees Fahrenheit) at sea level.&#34;, &#34;The boiling point of water can change with altitude.&#34;]
</span></span></span><span class=line><span class=cl><span class=s2>            classification: 
</span></span></span><span class=line><span class=cl><span class=s2>            {{&#34;TP&#34;: [{{&#34;statement&#34;: &#34;The boiling point of water is 100 degrees Celsius at sea level&#34;, &#34;reason&#34;: &#34;This statement is directly supported by the ground truth which specifies the boiling point of water as 100 degrees Celsius at sea level.&#34;}}], &#34;FP&#34;: [], &#34;FN&#34;: [{{&#34;statement&#34;: &#34;The boiling point of water can change with altitude.&#34;, &#34;reason&#34;: &#34;This additional information about how the boiling point of water can vary with altitude is not mentioned in the answer.&#34;}}]}}
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;human&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            question:&#34;</span><span class=si>{Query}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer:&#34;</span><span class=si>{Answer}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            ground_truth:&#34;</span><span class=si>{GroundTruth}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            classification:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_v</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>context</span><span class=p>,</span> <span class=n>answer</span><span class=p>,</span> <span class=n>ground_truth</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>output_schema</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    {&#34;type&#34;: &#34;object&#34;, &#34;properties&#34;: {&#34;TP&#34;: {&#34;title&#34;: &#34;Tp&#34;, &#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {&#34;type&#34;: &#34;object&#34;}}, &#34;FP&#34;: {&#34;title&#34;: &#34;Fp&#34;, &#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {&#34;type&#34;: &#34;object&#34;}}, &#34;FN&#34;: {&#34;title&#34;: &#34;Fn&#34;, &#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {&#34;type&#34;: &#34;object&#34;}}}, &#34;required&#34;: [&#34;TP&#34;, &#34;FP&#34;, &#34;FN&#34;]}
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>chain</span> <span class=o>=</span> <span class=n>PROMPT</span> <span class=o>|</span> <span class=n>llm</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OutputSchema&#34;</span><span class=p>:</span> <span class=n>output_schema</span><span class=p>,</span> <span class=s2>&#34;Query&#34;</span><span class=p>:</span> <span class=n>query</span><span class=p>,</span> <span class=s2>&#34;Context&#34;</span><span class=p>:</span> <span class=n>context</span><span class=p>,</span> <span class=s2>&#34;Answer&#34;</span><span class=p>:</span> <span class=n>answer</span><span class=p>,</span> <span class=s2>&#34;GroundTruth&#34;</span><span class=p>:</span> <span class=n>ground_truth</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>content</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># verdict = None</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>content</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>classes</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>query</span> <span class=o>=</span> <span class=s2>&#34;ä»‹ç»ä¸‹è‰¾è²å°”é“å¡”&#34;</span>
</span></span><span class=line><span class=cl><span class=n>contexts</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;åŸƒè²å°”é“å¡”ï¼ˆä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€[3]ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ground_truth</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”ï¼ˆæ³•è¯­ï¼šTour Eiffelï¼Œ/ËˆaÉªfÉ™l/ [tuÊâ€¿É›fÉ›l] ï¼ˆâ“˜ï¼‰ï¼Œä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€[3]ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©ã€‚æ­£å¼åœ°å€ä¸ºRue Anatole-France 5å·ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚é“å¡”æ˜¯ä¸–ç•Œå»ºç­‘å²ä¸Šçš„æŠ€æœ¯æ°ä½œï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤šäººä»˜è´¹å‚è§‚çš„åèƒœå¤è¿¹ï¼Œè¿™ä¸ªä¸ºäº†ä¸–ç•Œåšè§ˆä¼šè€Œè½æˆçš„é‡‘å±å»ºç­‘ï¼Œ2011å¹´çº¦æœ‰698ä¸‡äººå‚è§‚[4]ï¼Œæ˜¯æ³•å›½å‚è§‚äººæ•°ç¬¬äºŒå¤šçš„æ–‡åŒ–æ™¯ç‚¹ã€‚1986å¹´ç¾å›½åœŸæœ¨å·¥ç¨‹å¸ˆåä¼šå°†è¯¥å»ºç­‘åˆ—å…¥å›½é™…åœŸæœ¨å·¥ç¨‹å†å²å¤è¿¹ï¼Œ1991å¹´ï¼ŒåŸƒè²å°”é“å¡”è¿åŒå·´é»å¡çº³æ²³æ²¿å²¸æ•´åº§è¢«åˆ—å…¥ä¸–ç•Œé—äº§ã€‚[5]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”ä»¥312ç±³çš„é«˜åº¦ï¼Œå æ®ä¸–ç•Œæœ€é«˜äººé€ å»ºç­‘çš„ä½ç½®é•¿è¾¾å››åå¹´ï¼Œç›´åˆ°çº½çº¦å…‹è±æ–¯å‹’å¤§æ¥¼çš„å‡ºç°ï¼Œå…¶ä½äº279.11ç±³å¤„çš„è§‚æ™¯å¹³å°æ˜¯æ¬§ç›ŸèŒƒå›´å†…å…¬ä¼—èƒ½å¤ŸæŠµè¾¾çš„æœ€é«˜çš„è§‚æ™¯å°ï¼Œåœ¨å…¨æ¬§æ´²èŒƒå›´å†…ä»…æ¬¡äºè«æ–¯ç§‘çš„å¥¥æ–¯å¦é‡‘è¯ºç”µè§†å¡”ã€‚é“å¡”çš„æ€»é«˜åº¦æ›¾é€šè¿‡å®‰è£…å¤©çº¿è€Œå¤šæ¬¡æé«˜ã€‚è¿™äº›å¤©çº¿æ›¾è¢«ç”¨äºè®¸å¤šç§‘å­¦å®éªŒï¼Œç°åœ¨ä¸»è¦ç”¨äºå‘å°„å¹¿æ’­ç”µè§†ä¿¡å·ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>answer</span> <span class=o>=</span> <span class=s2>&#34;åŸƒè²å°”é“å¡”ï¼ˆä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒº&#34;</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>get_v</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=s2>&#34;.&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>contexts</span><span class=p>),</span> <span class=n>answer</span><span class=p>,</span> <span class=n>ground_truth</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pprint</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>compute_statement_presence</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>prediction</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>tp</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>prediction</span><span class=p>[</span><span class=s2>&#34;TP&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>fp</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>prediction</span><span class=p>[</span><span class=s2>&#34;FP&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>fn</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>prediction</span><span class=p>[</span><span class=s2>&#34;FN&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span> <span class=o>=</span> <span class=n>tp</span> <span class=o>/</span> <span class=p>(</span><span class=n>tp</span> <span class=o>+</span> <span class=mf>0.5</span> <span class=o>*</span> <span class=p>(</span><span class=n>fp</span> <span class=o>+</span> <span class=n>fn</span><span class=p>))</span> <span class=k>if</span> <span class=n>tp</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>score</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Answer Correctness: &#34;</span><span class=p>,</span> <span class=n>compute_statement_presence</span><span class=p>(</span><span class=n>result</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#39;FN&#39;: [{&#39;reason&#39;: &#39;This detailed description of the Eiffel Tower, including &#39;
</span></span><span class=line><span class=cl>                   &#39;its material, cultural significance, and formal address, &#39;
</span></span><span class=line><span class=cl>                   &#39;is missing from the answer.&#39;,
</span></span><span class=line><span class=cl>         &#39;statement&#39;: &#39;åŸƒè²å°”é“å¡”æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©ã€‚æ­£å¼åœ°å€ä¸ºRue &#39;
</span></span><span class=line><span class=cl>                      &#39;Anatole-France 5å·ã€‚&#39;},
</span></span><span class=line><span class=cl>        {&#39;reason&#39;: &#39;The construction year and original name of the Eiffel &#39;
</span></span><span class=line><span class=cl>                   &#39;Tower are not mentioned in the answer.&#39;,
</span></span><span class=line><span class=cl>         &#39;statement&#39;: &#39;åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚&#39;},
</span></span><span class=line><span class=cl>        {&#39;reason&#39;: &#39;The answer does not include any information about its &#39;
</span></span><span class=line><span class=cl>                   &#39;status as a historical engineering marvel or visitor &#39;
</span></span><span class=line><span class=cl>                   &#39;statistics.&#39;,
</span></span><span class=line><span class=cl>         &#39;statement&#39;: &#39;é“å¡”æ˜¯ä¸–ç•Œå»ºç­‘å²ä¸Šçš„æŠ€æœ¯æ°ä½œï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤šäººä»˜è´¹å‚è§‚çš„åèƒœå¤è¿¹ï¼Œè¿™ä¸ªä¸ºäº†ä¸–ç•Œåšè§ˆä¼šè€Œè½æˆçš„é‡‘å±å»ºç­‘ï¼Œ2011å¹´çº¦æœ‰698ä¸‡äººå‚è§‚ï¼Œæ˜¯æ³•å›½å‚è§‚äººæ•°ç¬¬äºŒå¤šçš„æ–‡åŒ–æ™¯ç‚¹ã€‚&#39;},
</span></span><span class=line><span class=cl>        {&#39;reason&#39;: &#39;This important historical recognition of the Eiffel Tower &#39;
</span></span><span class=line><span class=cl>                   &#39;is absent in the answer.&#39;,
</span></span><span class=line><span class=cl>         &#39;statement&#39;: &#39;1986å¹´ç¾å›½åœŸæœ¨å·¥ç¨‹å¸ˆåä¼šå°†è¯¥å»ºç­‘åˆ—å…¥å›½é™…åœŸæœ¨å·¥ç¨‹å†å²å¤è¿¹ï¼Œ1991å¹´ï¼ŒåŸƒè²å°”é“å¡”è¿åŒå·´é»å¡çº³æ²³æ²¿å²¸æ•´åº§è¢«åˆ—å…¥ä¸–ç•Œé—äº§ã€‚&#39;},
</span></span><span class=line><span class=cl>        {&#39;reason&#39;: &#39;The height of the Eiffel Tower and its ranking among &#39;
</span></span><span class=line><span class=cl>                   &#39;man-made structures are not mentioned in the answer.&#39;,
</span></span><span class=line><span class=cl>         &#39;statement&#39;: &#39;åŸƒè²å°”é“å¡”ä»¥312ç±³çš„é«˜åº¦ï¼Œå æ®ä¸–ç•Œæœ€é«˜äººé€ å»ºç­‘çš„ä½ç½®é•¿è¾¾å››åå¹´ï¼Œç›´åˆ°çº½çº¦å…‹è±æ–¯å‹’å¤§æ¥¼çš„å‡ºç°ã€‚&#39;},
</span></span><span class=line><span class=cl>        {&#39;reason&#39;: &#39;Information about the viewing platform and its &#39;
</span></span><span class=line><span class=cl>                   &#39;significance is missing from the answer.&#39;,
</span></span><span class=line><span class=cl>         &#39;statement&#39;: &#39;å…¶ä½äº279.11ç±³å¤„çš„è§‚æ™¯å¹³å°æ˜¯æ¬§ç›ŸèŒƒå›´å†…å…¬ä¼—èƒ½å¤ŸæŠµè¾¾çš„æœ€é«˜çš„è§‚æ™¯å°ï¼Œåœ¨å…¨æ¬§æ´²èŒƒå›´å†…ä»…æ¬¡äºè«æ–¯ç§‘çš„å¥¥æ–¯å¦é‡‘è¯ºç”µè§†å¡”ã€‚&#39;},
</span></span><span class=line><span class=cl>        {&#39;reason&#39;: &#39;The mention of the antennas and their functions is not &#39;
</span></span><span class=line><span class=cl>                   &#39;covered in the answer.&#39;,
</span></span><span class=line><span class=cl>         &#39;statement&#39;: &#39;é“å¡”çš„æ€»é«˜åº¦æ›¾é€šè¿‡å®‰è£…å¤©çº¿è€Œå¤šæ¬¡æé«˜ã€‚è¿™äº›å¤©çº¿æ›¾è¢«ç”¨äºè®¸å¤šç§‘å­¦å®éªŒï¼Œç°åœ¨ä¸»è¦ç”¨äºå‘å°„å¹¿æ’­ç”µè§†ä¿¡å·ã€‚&#39;}],
</span></span><span class=line><span class=cl> &#39;FP&#39;: [],
</span></span><span class=line><span class=cl> &#39;TP&#39;: [{&#39;reason&#39;: &#39;This statement is directly supported by the ground truth, &#39;
</span></span><span class=line><span class=cl>                   &#39;which states that the Eiffel Tower is located in the 7th &#39;
</span></span><span class=line><span class=cl>                   &#39;arrondissement of Paris.&#39;,
</span></span><span class=line><span class=cl>         &#39;statement&#39;: &#39;åŸƒè²å°”é“å¡”ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒº&#39;}]}
</span></span><span class=line><span class=cl>Answer Correctness:  0.2222222222222222
</span></span></code></pre></td></tr></table></div></div><h4 id=answer-semantic-similarity>Answer Semantic Similarity</h4><p>Answer Semantic Similarityï¼ˆç­”æ¡ˆçš„è¯­ä¹‰ç›¸ä¼¼æ€§ï¼‰æ˜¯ç”¨æ¥è¯„ä¼°ç”Ÿæˆç­”æ¡ˆä¸åŸå§‹äº‹å®åœ¨è¯­ä¹‰ä¸Šç›¸è¿‘ç¨‹åº¦çš„å…³é”®æŒ‡æ ‡ã€‚é€šè¿‡è®¡ç®—ç”Ÿæˆç­”æ¡ˆä¸åŸºæœ¬äº‹å®çš„åµŒå…¥å‘é‡ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå¯ä»¥é‡åŒ–è¿™ç§ç›¸ä¼¼æ€§ã€‚å¦‚æœè®¾å®šäº†ä¸€ä¸ªç‰¹å®šçš„é˜ˆå€¼ï¼Œæ ¹æ®è®¡ç®—ç»“æœï¼Œå¾—åˆ†ä¼šè¢«è½¬æ¢ä¸ºäºŒè¿›åˆ¶å€¼ï¼›å³ï¼Œå½“ä½™å¼¦ç›¸ä¼¼åº¦å¤§äºæˆ–ç­‰äºè¯¥é˜ˆå€¼æ—¶ï¼Œå€¼ä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚</p>\[
Answer\:Semantic\:Similarity = \cos(\hat{v}_{\text{answer}}, \hat{v}_{\text{fact}})
\]<ul><li>\(\hat{v}_{\text{answer}}\)ï¼šè¡¨ç¤ºç”Ÿæˆç­”æ¡ˆçš„åµŒå…¥å‘é‡ã€‚</li><li>\(\hat{v}_{\text{fact}}\)ï¼šè¡¨ç¤ºåŸºæœ¬äº‹å®çš„åµŒå…¥å‘é‡ã€‚</li><li>é˜ˆå€¼ï¼šç”¨äºå°†ç›¸ä¼¼åº¦å¾—åˆ†è½¬æ¢ä¸ºäºŒè¿›åˆ¶åˆ¤æ–­çš„ä¸´ç•Œå€¼ã€‚</li></ul><figure><img src=/images/Answer%20Semantic%20Similarity%20Calculate.png width=90%><figcaption><h4>å›¾ 9. Answer Semantic Similarity è®¡ç®—è¿‡ç¨‹</h4></figcaption></figure><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>OpenAIEmbeddings</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>embeddings</span> <span class=o>=</span> <span class=n>OpenAIEmbeddings</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>=</span><span class=s2>&#34;text-embedding-3-small&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>query</span> <span class=o>=</span> <span class=s2>&#34;ä»‹ç»ä¸‹è‰¾è²å°”é“å¡”&#34;</span>
</span></span><span class=line><span class=cl><span class=n>ground_truth</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”ï¼ˆæ³•è¯­ï¼šTour Eiffelï¼Œ/ËˆaÉªfÉ™l/ [tuÊâ€¿É›fÉ›l] ï¼ˆâ“˜ï¼‰ï¼Œä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€[3]ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©ã€‚æ­£å¼åœ°å€ä¸ºRue Anatole-France 5å·ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚é“å¡”æ˜¯ä¸–ç•Œå»ºç­‘å²ä¸Šçš„æŠ€æœ¯æ°ä½œï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤šäººä»˜è´¹å‚è§‚çš„åèƒœå¤è¿¹ï¼Œè¿™ä¸ªä¸ºäº†ä¸–ç•Œåšè§ˆä¼šè€Œè½æˆçš„é‡‘å±å»ºç­‘ï¼Œ2011å¹´çº¦æœ‰698ä¸‡äººå‚è§‚[4]ï¼Œæ˜¯æ³•å›½å‚è§‚äººæ•°ç¬¬äºŒå¤šçš„æ–‡åŒ–æ™¯ç‚¹ã€‚1986å¹´ç¾å›½åœŸæœ¨å·¥ç¨‹å¸ˆåä¼šå°†è¯¥å»ºç­‘åˆ—å…¥å›½é™…åœŸæœ¨å·¥ç¨‹å†å²å¤è¿¹ï¼Œ1991å¹´ï¼ŒåŸƒè²å°”é“å¡”è¿åŒå·´é»å¡çº³æ²³æ²¿å²¸æ•´åº§è¢«åˆ—å…¥ä¸–ç•Œé—äº§ã€‚[5]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”ä»¥312ç±³çš„é«˜åº¦ï¼Œå æ®ä¸–ç•Œæœ€é«˜äººé€ å»ºç­‘çš„ä½ç½®é•¿è¾¾å››åå¹´ï¼Œç›´åˆ°çº½çº¦å…‹è±æ–¯å‹’å¤§æ¥¼çš„å‡ºç°ï¼Œå…¶ä½äº279.11ç±³å¤„çš„è§‚æ™¯å¹³å°æ˜¯æ¬§ç›ŸèŒƒå›´å†…å…¬ä¼—èƒ½å¤ŸæŠµè¾¾çš„æœ€é«˜çš„è§‚æ™¯å°ï¼Œåœ¨å…¨æ¬§æ´²èŒƒå›´å†…ä»…æ¬¡äºè«æ–¯ç§‘çš„å¥¥æ–¯å¦é‡‘è¯ºç”µè§†å¡”ã€‚é“å¡”çš„æ€»é«˜åº¦æ›¾é€šè¿‡å®‰è£…å¤©çº¿è€Œå¤šæ¬¡æé«˜ã€‚è¿™äº›å¤©çº¿æ›¾è¢«ç”¨äºè®¸å¤šç§‘å­¦å®éªŒï¼Œç°åœ¨ä¸»è¦ç”¨äºå‘å°„å¹¿æ’­ç”µè§†ä¿¡å·ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>answer</span> <span class=o>=</span> <span class=s2>&#34;åŸƒè²å°”é“å¡”ï¼ˆä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒº&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>compute_similarity</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>answer</span><span class=p>,</span> <span class=n>ground_truth</span><span class=p>,</span> <span class=n>embeddings</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>embedding_1</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>embeddings</span><span class=o>.</span><span class=n>embed_query</span><span class=p>(</span><span class=n>ground_truth</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>embedding_2</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>embeddings</span><span class=o>.</span><span class=n>embed_query</span><span class=p>(</span><span class=n>answer</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># Normalization factors of the above embeddings</span>
</span></span><span class=line><span class=cl>    <span class=n>norms_1</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>embedding_1</span><span class=p>,</span> <span class=n>keepdims</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>norms_2</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>embedding_2</span><span class=p>,</span> <span class=n>keepdims</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>embedding_1_normalized</span> <span class=o>=</span> <span class=n>embedding_1</span> <span class=o>/</span> <span class=n>norms_1</span>
</span></span><span class=line><span class=cl>    <span class=n>embedding_2_normalized</span> <span class=o>=</span> <span class=n>embedding_2</span> <span class=o>/</span> <span class=n>norms_2</span>
</span></span><span class=line><span class=cl>    <span class=n>similarity</span> <span class=o>=</span> <span class=n>embedding_1_normalized</span> <span class=o>@</span> <span class=n>embedding_2_normalized</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span> <span class=o>=</span> <span class=n>similarity</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>score</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Answer Correctness: &#34;</span><span class=p>,</span> <span class=n>compute_similarity</span><span class=p>(</span><span class=n>answer</span><span class=p>,</span> <span class=n>ground_truth</span><span class=p>,</span> <span class=n>embeddings</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Answer Correctness:  [0.70861593]
</span></span></code></pre></td></tr></table></div></div><h4 id=answer-fathfulness>Answer Fathfulness</h4><p>Faithfulnessï¼ˆå¿ å®æ€§ï¼‰æŒ‡æ ‡ç”¨äºè¡¡é‡ç”Ÿæˆç­”æ¡ˆä¸ç»™å®šä¸Šä¸‹æ–‡ä¹‹é—´çš„äº‹å®ä¸€è‡´æ€§ã€‚è¯¥æŒ‡æ ‡é€šè¿‡ç”Ÿæˆç­”æ¡ˆå’Œæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡è¿›è¡Œè®¡ç®—ï¼Œå…¶ç»“æœè¢«ç¼©æ”¾è‡³ (0,1) åŒºé—´ï¼Œæ•°å€¼è¶Šé«˜è¡¨ç¤ºå¿ å®æ€§è¶Šå¼ºã€‚</p><p>å¦‚æœç”Ÿæˆçš„ç­”æ¡ˆä¸­æ‰€åšå‡ºçš„æ‰€æœ‰é™ˆè¿°éƒ½èƒ½å¤Ÿä»ç»™å®šçš„ä¸Šä¸‹æ–‡ä¸­æ¨å¯¼å‡ºæ¥ï¼Œåˆ™è§†ä¸ºå¿ å®ã€‚åœ¨è®¡ç®—å¿ å®æ€§æ—¶ï¼Œé¦–å…ˆä»ç”Ÿæˆçš„ç­”æ¡ˆä¸­è¯†åˆ«å‡ºä¸€ç»„é™ˆè¿°ï¼Œç„¶åå°†æ¯ä¸€ä¸ªé™ˆè¿°ä¸ç»™å®šçš„ä¸Šä¸‹æ–‡è¿›è¡Œé€ä¸€æ ¸å¯¹ï¼Œåˆ¤æ–­å…¶æ˜¯å¦å¯ä»¥ä»ä¸Šä¸‹æ–‡ä¸­æ¨å¯¼å‡ºæ¥ã€‚å¿ å®æ€§å¾—åˆ†çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p>\[
Faithfulness score = \frac{å¯ä»¥æ¨å¯¼å‡ºçš„é™ˆè¿°æ•°é‡}{é™ˆè¿°æ€»æ•°é‡}
\]<ul><li>å¯ä»¥æ¨å¯¼å‡ºçš„é™ˆè¿°æ•°é‡ï¼šæŒ‡ç”Ÿæˆç­”æ¡ˆä¸­ï¼Œä¸ç»™å®šä¸Šä¸‹æ–‡æ ¸å¯¹åç¡®è®¤å¯ä»¥æ¨å¯¼å‡ºçš„é™ˆè¿°æ•°é‡ã€‚</li><li>é™ˆè¿°æ€»æ•°é‡ï¼šæŒ‡ä»ç”Ÿæˆçš„ç­”æ¡ˆä¸­è¯†åˆ«å‡ºçš„å…¨éƒ¨é™ˆè¿°æ•°é‡ã€‚</li></ul><p>å…¶ä¸­é™ˆè¿°æ€»æ•°é‡æ˜¯é€šè¿‡å¤§æ¨¡å‹è¿›è¡Œæ‹†åˆ†ï¼Œä¸‹é¢æ˜¯æ ¹æ®RAGè¾“å‡ºçš„ç­”æ¡ˆç”Ÿæˆé™ˆè¿°çš„Prompt</p><figure><img src=/images/Answer%20To%20Statements.png width=90%><figcaption><h4>å›¾ 10. Answer To Statements Prompt</h4></figcaption></figure><p>å¯ä»¥æ¨å¯¼å‡ºçš„é™ˆè¿°æ•°é‡ä¹Ÿæ˜¯é€šè¿‡å¤§æ¨¡å‹è¿›è¡Œåˆ¤æ–­ï¼Œæ ¹æ®ä¸Šè¿°è¿‡ç¨‹ç”Ÿæˆçš„é™ˆè¿°ä»¥åŠæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ï¼Œåˆ¤æ–­æ¨¡å‹ç”Ÿæˆçš„ç­”æ¡ˆæ˜¯å¦å¯ä»¥åœ¨ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°ä¾æ®ï¼Œä¸‹é¢ç»™å®šä¸Šä¸‹æ–‡åˆ¤æ–­æ˜¯å¦å¯ä»¥æ¨å¯¼å‡ºçš„é™ˆè¿°çš„Prompt</p><figure><img src=/images/Answer%20Statements%20Fathfulness.png width=90%><figcaption><h4>å›¾ 11. Answer Statements Fathfulness Prompt</h4></figcaption></figure><p>ä¸‹é¢æ˜¯Answer Fathfulnessçš„è®¡ç®—è¿‡ç¨‹</p><figure><img src=/images/Answer%20Fathfulness%20Calculate.png width=90%><figcaption><h4>å›¾ 12. Answer Fathfulness è®¡ç®—è¿‡ç¨‹</h4></figcaption></figure><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pprint</span> <span class=kn>import</span> <span class=n>pprint</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_openai</span> <span class=kn>import</span> <span class=n>ChatOpenAI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pysbd</span> <span class=kn>import</span> <span class=n>Segmenter</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain_core.prompts</span> <span class=kn>import</span> <span class=n>ChatPromptTemplate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>llm</span> <span class=o>=</span> <span class=n>ChatOpenAI</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-4o-mini&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>STATEMENTS_PROMPT</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;system&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Given a question, an answer, and sentences from the answer analyze the complexity of each sentence given under &#39;sentences&#39; and break down each sentence into one or more fully understandable statements while also ensuring no pronouns are used in each statement. Format the outputs in JSON.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            The output should be a well-formatted JSON instance that conforms to the JSON schema below.
</span></span></span><span class=line><span class=cl><span class=s2>            As an example, for the schema {{&#34;properties&#34;: {{&#34;foo&#34;: {{&#34;title&#34;: &#34;Foo&#34;, &#34;description&#34;: &#34;a list of strings&#34;, &#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {{&#34;type&#34;: &#34;string&#34;}}}}}}, &#34;required&#34;: [&#34;foo&#34;]}}
</span></span></span><span class=line><span class=cl><span class=s2>            the object {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}} is a well-formatted instance of the schema. The object {{&#34;properties&#34;: {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}}}} is not well-formatted.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Here is the output JSON schema:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            </span><span class=si>{OutputSchema}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>                                                
</span></span></span><span class=line><span class=cl><span class=s2>            Do not return any preamble or explanations, return only a pure JSON string surrounded by triple backticks (```).
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Examples:
</span></span></span><span class=line><span class=cl><span class=s2>            question: &#34;Who was Albert Einstein and what is he best known for?&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer: &#34;He was a German-born theoretical physicist, widely acknowledged to be one of the greatest and most influential physicists of all time. He was best known for developing the theory of relativity, he also made important contributions to the development of the theory of quantum mechanics.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            sentences: 
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;0:He was a German-born theoretical physicist, widely acknowledged to be one of the greatest and most influential physicists of all time. 
</span></span></span><span class=line><span class=cl><span class=s2>            1:He was best known for developing the theory of relativity, he also made important contributions to the development of the theory of quantum mechanics.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            analysis:
</span></span></span><span class=line><span class=cl><span class=s2>            [{{&#34;sentence_index&#34;: 0, &#34;simpler_statements&#34;: [&#34;Albert Einstein was a German-born theoretical physicist.&#34;, &#34;Albert Einstein is recognized as one of the greatest and most influential physicists of all time.&#34;]}}, {{&#34;sentence_index&#34;: 1, &#34;simpler_statements&#34;: [&#34;Albert Einstein was best known for developing the theory of relativity.&#34;, &#34;Albert Einstein also made important contributions to the development of the theory of quantum mechanics.&#34;]}}]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;human&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            question:&#34;</span><span class=si>{Query}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer:&#34;</span><span class=si>{Answer}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            sentences:&#34;</span><span class=si>{Sentences}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            analysis:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_statements</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>answer</span><span class=p>,</span> <span class=n>sentences</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>output_schema</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    {&#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {&#34;$ref&#34;: &#34;#/definitions/Statements&#34;}, &#34;definitions&#34;: {&#34;Statements&#34;: {&#34;title&#34;: &#34;Statements&#34;, &#34;type&#34;: &#34;object&#34;, &#34;properties&#34;: {&#34;sentence_index&#34;: {&#34;title&#34;: &#34;Sentence Index&#34;, &#34;description&#34;: &#34;Index of the sentence from the statement list&#34;, &#34;type&#34;: &#34;integer&#34;}, &#34;simpler_statements&#34;: {&#34;title&#34;: &#34;Simpler Statements&#34;, &#34;description&#34;: &#34;the simpler statements&#34;, &#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {&#34;type&#34;: &#34;string&#34;}}}, &#34;required&#34;: [&#34;sentence_index&#34;, &#34;simpler_statements&#34;]}}}
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>chain</span> <span class=o>=</span> <span class=n>STATEMENTS_PROMPT</span> <span class=o>|</span> <span class=n>llm</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OutputSchema&#34;</span><span class=p>:</span> <span class=n>output_schema</span><span class=p>,</span> <span class=s2>&#34;Query&#34;</span><span class=p>:</span> <span class=n>query</span><span class=p>,</span> <span class=s2>&#34;Answer&#34;</span><span class=p>:</span> <span class=n>answer</span><span class=p>,</span> <span class=s2>&#34;Sentences&#34;</span><span class=p>:</span> <span class=n>sentences</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>content</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># verdict = None</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>content</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>classes</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>query</span> <span class=o>=</span> <span class=s2>&#34;ä»‹ç»ä¸‹è‰¾è²å°”é“å¡”&#34;</span>
</span></span><span class=line><span class=cl><span class=n>contexts</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;åŸƒè²å°”é“å¡”ï¼ˆä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€[3]ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ground_truth</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”ï¼ˆæ³•è¯­ï¼šTour Eiffelï¼Œ/ËˆaÉªfÉ™l/ [tuÊâ€¿É›fÉ›l] ï¼ˆâ“˜ï¼‰ï¼Œä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰æ˜¯ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€å¡çº³æ²³ç•”æˆ˜ç¥å¹¿åœºçš„é“åˆ¶é•‚ç©ºå¡”ï¼Œä¸–ç•Œè‘—åå»ºç­‘ï¼Œä¹Ÿæ˜¯æ³•å›½æ–‡åŒ–è±¡å¾ä¹‹ä¸€[3]ï¼Œå·´é»åŸå¸‚åœ°æ ‡ä¹‹ä¸€ï¼Œå·´é»æœ€é«˜å»ºç­‘ç‰©ã€‚æ­£å¼åœ°å€ä¸ºRue Anatole-France 5å·ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”å»ºæˆäº1889å¹´ï¼Œåˆåä¸ºâ€œä¸‰ç™¾ç±³å¡”â€ï¼Œåå¾—åè‡ªå…¶è®¾è®¡å¸ˆå±…æ–¯å¡”å¤«Â·åŸƒè²å°”ã€‚é“å¡”æ˜¯ä¸–ç•Œå»ºç­‘å²ä¸Šçš„æŠ€æœ¯æ°ä½œï¼Œä¹Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤šäººä»˜è´¹å‚è§‚çš„åèƒœå¤è¿¹ï¼Œè¿™ä¸ªä¸ºäº†ä¸–ç•Œåšè§ˆä¼šè€Œè½æˆçš„é‡‘å±å»ºç­‘ï¼Œ2011å¹´çº¦æœ‰698ä¸‡äººå‚è§‚[4]ï¼Œæ˜¯æ³•å›½å‚è§‚äººæ•°ç¬¬äºŒå¤šçš„æ–‡åŒ–æ™¯ç‚¹ã€‚1986å¹´ç¾å›½åœŸæœ¨å·¥ç¨‹å¸ˆåä¼šå°†è¯¥å»ºç­‘åˆ—å…¥å›½é™…åœŸæœ¨å·¥ç¨‹å†å²å¤è¿¹ï¼Œ1991å¹´ï¼ŒåŸƒè²å°”é“å¡”è¿åŒå·´é»å¡çº³æ²³æ²¿å²¸æ•´åº§è¢«åˆ—å…¥ä¸–ç•Œé—äº§ã€‚[5]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>åŸƒè²å°”é“å¡”ä»¥312ç±³çš„é«˜åº¦ï¼Œå æ®ä¸–ç•Œæœ€é«˜äººé€ å»ºç­‘çš„ä½ç½®é•¿è¾¾å››åå¹´ï¼Œç›´åˆ°çº½çº¦å…‹è±æ–¯å‹’å¤§æ¥¼çš„å‡ºç°ï¼Œå…¶ä½äº279.11ç±³å¤„çš„è§‚æ™¯å¹³å°æ˜¯æ¬§ç›ŸèŒƒå›´å†…å…¬ä¼—èƒ½å¤ŸæŠµè¾¾çš„æœ€é«˜çš„è§‚æ™¯å°ï¼Œåœ¨å…¨æ¬§æ´²èŒƒå›´å†…ä»…æ¬¡äºè«æ–¯ç§‘çš„å¥¥æ–¯å¦é‡‘è¯ºç”µè§†å¡”ã€‚é“å¡”çš„æ€»é«˜åº¦æ›¾é€šè¿‡å®‰è£…å¤©çº¿è€Œå¤šæ¬¡æé«˜ã€‚è¿™äº›å¤©çº¿æ›¾è¢«ç”¨äºè®¸å¤šç§‘å­¦å®éªŒï¼Œç°åœ¨ä¸»è¦ç”¨äºå‘å°„å¹¿æ’­ç”µè§†ä¿¡å·ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>answer</span> <span class=o>=</span> <span class=s2>&#34;åŸƒè²å°”é“å¡”ï¼ˆä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒº&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>seg</span> <span class=o>=</span> <span class=n>Segmenter</span><span class=p>(</span><span class=n>language</span><span class=o>=</span><span class=s2>&#34;zh&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>statements</span> <span class=o>=</span> <span class=n>seg</span><span class=o>.</span><span class=n>segment</span><span class=p>(</span><span class=n>answer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>get_statements</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>answer</span><span class=p>,</span> <span class=n>statements</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pprint</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>FATHFULNESS_PROMPT</span> <span class=o>=</span> <span class=n>ChatPromptTemplate</span><span class=o>.</span><span class=n>from_messages</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;system&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Your task is to judge the faithfulness of a series of statements based on a given context. For each statement you must return verdict as 1 if the statement can be directly inferred based on the context or 0 if the statement can not be directly inferred based on the context.
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>            The output should be a well-formatted JSON instance that conforms to the JSON schema below.
</span></span></span><span class=line><span class=cl><span class=s2>            As an example, for the schema {{&#34;properties&#34;: {{&#34;foo&#34;: {{&#34;title&#34;: &#34;Foo&#34;, &#34;description&#34;: &#34;a list of strings&#34;, &#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {{&#34;type&#34;: &#34;string&#34;}}}}}}, &#34;required&#34;: [&#34;foo&#34;]}}
</span></span></span><span class=line><span class=cl><span class=s2>            the object {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}} is a well-formatted instance of the schema. The object {{&#34;properties&#34;: {{&#34;foo&#34;: [&#34;bar&#34;, &#34;baz&#34;]}}}} is not well-formatted.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Here is the output JSON schema:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            </span><span class=si>{OutputSchema}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>                                                
</span></span></span><span class=line><span class=cl><span class=s2>            Do not return any preamble or explanations, return only a pure JSON string surrounded by triple backticks (```).
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            Examples:
</span></span></span><span class=line><span class=cl><span class=s2>            context: &#34;John is a student at XYZ University. He is pursuing a degree in Computer Science. He is enrolled in several courses this semester, including Data Structures, Algorithms, and Database Management. John is a diligent student and spends a significant amount of time studying and completing assignments. He often stays late in the library to work on his projects.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            statements: [&#34;John is majoring in Biology.&#34;, &#34;John is taking a course on Artificial Intelligence.&#34;, &#34;John is a dedicated student.&#34;, &#34;John has a part-time job.&#34;]
</span></span></span><span class=line><span class=cl><span class=s2>            answer: [{{&#34;statement&#34;: &#34;John is majoring in Biology.&#34;, &#34;reason&#34;: &#34;John</span><span class=se>\&#39;</span><span class=s2>s major is explicitly mentioned as Computer Science. There is no information suggesting he is majoring in Biology.&#34;, &#34;verdict&#34;: 0}}, {{&#34;statement&#34;: &#34;John is taking a course on Artificial Intelligence.&#34;, &#34;reason&#34;: &#34;The context mentions the courses John is currently enrolled in, and Artificial Intelligence is not mentioned. Therefore, it cannot be deduced that John is taking a course on AI.&#34;, &#34;verdict&#34;: 0}}, {{&#34;statement&#34;: &#34;John is a dedicated student.&#34;, &#34;reason&#34;: &#34;The context states that he spends a significant amount of time studying and completing assignments. Additionally, it mentions that he often stays late in the library to work on his projects, which implies dedication.&#34;, &#34;verdict&#34;: 1}}, {{&#34;statement&#34;: &#34;John has a part-time job.&#34;, &#34;reason&#34;: &#34;There is no information given in the context about John having a part-time job.&#34;, &#34;verdict&#34;: 0}}]
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            context: &#34;Photosynthesis is a process used by plants, algae, and certain bacteria to convert light energy into chemical energy.&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            statements: [&#34;Albert Einstein was a genius.&#34;]
</span></span></span><span class=line><span class=cl><span class=s2>            answer: [{{&#34;statement&#34;: &#34;Albert Einstein was a genius.&#34;, &#34;reason&#34;: &#34;The context and statement are unrelated&#34;, &#34;verdict&#34;: 0}}]
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;human&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            Your actual task:
</span></span></span><span class=line><span class=cl><span class=s2>            context:&#34;</span><span class=si>{Context}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            statements:&#34;</span><span class=si>{Statements}</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            answer:
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_fathfullness_results</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>statements</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>output_schema</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    {&#34;type&#34;: &#34;array&#34;, &#34;items&#34;: {&#34;$ref&#34;: &#34;#/definitions/StatementFaithfulnessAnswer&#34;}, &#34;definitions&#34;: {&#34;StatementFaithfulnessAnswer&#34;: {&#34;title&#34;: &#34;StatementFaithfulnessAnswer&#34;, &#34;type&#34;: &#34;object&#34;, &#34;properties&#34;: {&#34;statement&#34;: {&#34;title&#34;: &#34;Statement&#34;, &#34;description&#34;: &#34;the original statement, word-by-word&#34;, &#34;type&#34;: &#34;string&#34;}, &#34;reason&#34;: {&#34;title&#34;: &#34;Reason&#34;, &#34;description&#34;: &#34;the reason of the verdict&#34;, &#34;type&#34;: &#34;string&#34;}, &#34;verdict&#34;: {&#34;title&#34;: &#34;Verdict&#34;, &#34;description&#34;: &#34;the verdict(0/1) of the faithfulness.&#34;, &#34;type&#34;: &#34;integer&#34;}}, &#34;required&#34;: [&#34;statement&#34;, &#34;reason&#34;, &#34;verdict&#34;]}}}
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>chain</span> <span class=o>=</span> <span class=n>FATHFULNESS_PROMPT</span> <span class=o>|</span> <span class=n>llm</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>chain</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OutputSchema&#34;</span><span class=p>:</span> <span class=n>output_schema</span><span class=p>,</span> <span class=s2>&#34;Context&#34;</span><span class=p>:</span> <span class=n>context</span><span class=p>,</span> <span class=s2>&#34;Statements&#34;</span><span class=p>:</span> <span class=n>statements</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>content</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```json&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;```&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># verdict = None</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>content</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=n>get_fathfullness_results</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>contexts</span><span class=p>),</span> <span class=n>statements</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>verdicts</span> <span class=o>=</span> <span class=p>[</span><span class=n>_</span><span class=p>[</span><span class=s2>&#34;verdict&#34;</span><span class=p>]</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>results</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Answer Fathfulness: &#34;</span><span class=p>,</span> <span class=nb>sum</span><span class=p>(</span><span class=n>verdicts</span><span class=p>)</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>verdicts</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[{&#39;sentence_index&#39;: 0,
</span></span><span class=line><span class=cl>  &#39;simpler_statements&#39;: [&#39;åŸƒè²å°”é“å¡”ä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ã€‚&#39;, &#39;åŸƒè²å°”é“å¡”ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºã€‚&#39;]}]
</span></span><span class=line><span class=cl>[{&#39;statement&#39;: &#39;åŸƒè²å°”é“å¡”ï¼ˆä¹Ÿå¸¸ç§°ä¸ºå·´é»é“å¡”ï¼‰ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒº&#39;, &#39;reason&#39;: &#39;ä¸Šä¸‹æ–‡æ˜ç¡®æåˆ°åŸƒè²å°”é“å¡”ä½äºæ³•å›½å·´é»ç¬¬ä¸ƒåŒºï¼Œå› æ­¤è¯¥é™ˆè¿°å¯ä»¥ç›´æ¥æ¨æ–­ã€‚&#39;, &#39;verdict&#39;: 1}]
</span></span><span class=line><span class=cl>Answer Fathfulness:  1.0
</span></span></code></pre></td></tr></table></div></div><h2 id=è®¨è®º>è®¨è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†åŸºäºå¤§å‹è¯­è¨€æ¨¡å‹çš„RAGåº”ç”¨è‡ªåŠ¨åŒ–è¯„ä¼°æ–¹æ³•ï¼Œå¹¶è¯¦ç»†é˜è¿°äº†æ¯ä¸ªè¯„ä¼°æŒ‡æ ‡çš„æç¤ºè®¾è®¡åŠå…¶Pythonå®ç°æ–¹å¼ã€‚é€šè¿‡æœ¬ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä¸ä»…ç†è§£äº†å¦‚ä½•åˆ©ç”¨å¤§å‹è¯­è¨€æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œè¿˜å¯ä»¥æ ¹æ®è‡ªèº«çš„ä¸šåŠ¡åœºæ™¯åˆ¶å®šç›¸åº”çš„è¯„ä¼°æŒ‡æ ‡ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸Šè¿°è¯„ä¼°æŒ‡æ ‡çš„è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å‡ ä¸ªå…³é”®è¦ç´ ï¼Œå³<code>Query</code>ã€<code>Context</code>ã€<code>Answer</code>å’Œ<code>Ground Truth</code>ã€‚å…¶ä¸­ï¼Œ<code>Query</code>ã€<code>Context</code>å’Œ<code>Answer</code>æ˜¯RAGåº”ç”¨çš„è¾“å…¥ã€ä¸­é—´å˜é‡å’Œç”Ÿæˆç»“æœï¼Œè¿™äº›è¦ç´ ç›¸å¯¹å®¹æ˜“è·å–ã€‚ç„¶è€Œï¼Œè·å–<code>Ground Truth</code>é€šå¸¸è¾ƒä¸ºå›°éš¾ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>Ground Truth</code>å¯é€šè¿‡äººå·¥æˆ–ä¸“å®¶æ ‡æ³¨è·å¾—ï¼Œä½†è¿™ç§æ–¹æ³•å¾€å¾€éœ€è¦å¤§é‡çš„äººåŠ›èµ„æºã€‚</p><p>å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè§£å†³è‡ªåŠ¨ç”Ÿæˆ<code>Ground Truth</code>çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆæ•´ä¸ªè¯„ä¼°æµç¨‹å°†ä¼šå®ç°è‡ªåŠ¨åŒ–ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨<a class=link href=/p/rag%e5%ba%94%e7%94%a8%e5%bc%80%e5%8f%91%e6%8c%87%e5%8d%97%e4%b8%89%e5%a6%82%e4%bd%95%e8%87%aa%e5%8a%a8%e7%94%9f%e6%88%90%e9%ab%98%e8%b4%a8%e9%87%8f%e7%9a%84%e9%97%ae%e7%ad%94%e6%95%b0%e6%8d%ae/ title=å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡çš„é—®ç­”æ•°æ®>å¦‚ä½•åŸºäºæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡çš„é—®ç­”æ•°æ®</a>ã€‚</p><h2 id=å¼•ç”¨>å¼•ç”¨</h2><ol><li>Yu H, Gan A, Zhang K, et al. <a class=link href=https://arxiv.org/pdf/2005.11401 target=_blank rel=noopener>Evaluation of Retrieval-Augmented Generation: A Survey[J]</a>. arXiv preprint arXiv:2405.07437, 2024.</li><li><a class=link href=https://research.trychroma.com/evaluating-chunking target=_blank rel=noopener>https://research.trychroma.com/evaluating-chunking</a></li><li><a class=link href=https://github.com/explodinggradients/ragas target=_blank rel=noopener>https://github.com/explodinggradients/ragas</a></li></ol></section><footer class=article-footer><section class=article-tags><a href=/tags/langchain/>Langchain</a>
<a href=/tags/rag%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/>RAGåº”ç”¨å¼€å‘</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/rag%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%E4%B8%89%E5%A6%82%E4%BD%95%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E9%AB%98%E8%B4%A8%E9%87%8F%E7%9A%84%E9%97%AE%E7%AD%94%E6%95%B0%E6%8D%AE/><div class=article-details><h2 class=article-title>RAGåº”ç”¨å¼€å‘æŒ‡å—ï¼ˆä¸‰ï¼‰ï¼šå¦‚ä½•è‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡çš„é—®ç­”æ•°æ®</h2></div></a></article><article><a href=/p/rag%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%E4%B8%80%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90rag%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/><div class=article-details><h2 class=article-title>RAGåº”ç”¨å¼€å‘æŒ‡å—ï¼ˆä¸€ï¼‰ï¼šæ·±å…¥è§£æRAGåŸç†ä¸å®ç°</h2></div></a></article><article><a href=/p/ai%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6%E5%AF%B9%E6%AF%94/><div class=article-details><h2 class=article-title>AIåº”ç”¨å¼€å‘æ¡†æ¶å¯¹æ¯”</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2024 DIZS' Blog</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>